(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[9680],{92784:function(e,t,r){var i;"undefined"!=typeof self&&self,i=e=>(()=>{"use strict";var t=[,t=>{t.exports=e}],r={};function i(e){var o=r[e];if(void 0!==o)return o.exports;var n=r[e]={exports:{}};return t[e](n,n.exports,i),n.exports}i.d=(e,t)=>{for(var r in t)i.o(t,r)&&!i.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},i.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),i.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})};var o={};i.r(o),i.d(o,{ArrayBufferLoader:()=>g,arrayBufferLoader:()=>f,buildNumber:()=>m,stringLoader:()=>u,version:()=>y});var n=i(1);class a extends n.loader.LoaderRequest{constructor(e,t={},r=2e4){if(super(),this._responseStarted=!1,r<0)throw Error("Invaid timeout.");if(this._timeoutTimer=window.setTimeout(()=>this._onManualTimeout(),r),this._xhr=new XMLHttpRequest,this._xhr.addEventListener("load",()=>this._onLoad()),this._xhr.addEventListener("abort",()=>this._onAbort()),this._xhr.addEventListener("error",e=>this._onError(e)),this._xhr.addEventListener("timeout",()=>this._onTimeout()),this._xhr.addEventListener("loadend",()=>this._onLoadEnd()),this._xhr.addEventListener("progress",()=>this._onProgress()),this._xhr.open("GET",e,!0),this._xhr.timeout=r,!this._getResponseType().some(e=>(this._xhr.responseType=e,this._xhr.responseType===e)))throw Error("Failed setting response type.");Object.keys(t).forEach(e=>this._xhr.setRequestHeader(e,t[e])),this._signalRequestStart(),this._xhr.send()}_abort(){this._xhr.abort()}_onAbort(){this.hasCompleted()||this._onTimeout()}_onManualTimeout(){this.hasCompleted()||(this._signalTimeout(),this._xhr.abort())}_onTimeout(){this.hasCompleted()||this._signalTimeout()}_onLoad(){if(!this.hasCompleted()){if(!this._isChunkedResponse()){let e=this._xhr;this._provideStatusAndHeaders({statusCode:e.status,headers:this._parseHeaders(e.getAllResponseHeaders()||"")},e.response)}this.hasCompleted()||this._finalize()}}_onError(e){switch(this.getState()){case n.loader.ResponseState.COMPLETED:case n.loader.ResponseState.ERRORED:break;case n.loader.ResponseState.PENDING:if(0===this._xhr.status){this._provideStatusAndHeaders({statusCode:0,headers:{}},this._getEmptyData()),this._finalize();break}default:this._finalize(new n.loaderErrors.LoaderError("An error occurred.",e))}}_onLoadEnd(){window.clearTimeout(this._timeoutTimer),this.hasCompleted()||this._finalize(new n.loaderErrors.LoaderError("Unexpected error occurred."))}_onProgress(){if(this.hasCompleted())return;let e=this._xhr;this._isChunkedResponse()&&(this._responseStarted?this._providePart(e.response):(this._responseStarted=!0,this._provideStatusAndHeaders({statusCode:e.status,headers:this._parseHeaders(e.getAllResponseHeaders()||"")},e.response)))}_isChunkedResponse(){return"moz-chunked-arraybuffer"===this._xhr.responseType}_parseHeaders(e){let t={};if(!e)return t;let r=e.split("\r\n");for(let e=0,i=r.length;e<i;e++){let i=r[e],o=i.indexOf(": ");if(o>0){let e=i.substring(0,o).trim(),r=i.substring(o+2);t[e]=r}}return t}}let s=["text"];class l extends a{_getResponseType(){return s}_getEmptyData(){return""}_reduceParts(e){return e.join("")}}let u={request:({url:e,headers:t,timeout:r})=>new l(e,t,r)},h=n.helpers.browser.getFirefoxVersion(),c=h&&h.major>=60?["moz-chunked-arraybuffer","arraybuffer"]:["arraybuffer"];class d extends a{_getResponseType(){return c}_getEmptyData(){return new ArrayBuffer(0)}_reduceParts(e){return n.helpers.arrayBuffer.combine(e.map(e=>new Uint8Array(e))).buffer}}let _=n.helpers.browser.isFirefox();class p extends n.loader.LoaderRequest{constructor(e,t={},r=2e4){if(super(),!p.isSupported())throw Error("Not supported.");let i=new Request(e,{headers:t,redirect:"follow",signal:(this._abortController=new AbortController).signal});this._signalRequestStart();let o=this._abortTimer=window.setTimeout(()=>{this._signalTimeout(),this._abort()},r),a=fetch(i).then(e=>{let t={};if(e.headers.forEach((e,r)=>t[e]=r),this._provideStatusAndHeaders({statusCode:e.status,headers:t},new ArrayBuffer(0)),!e.body)return e.arrayBuffer().then(e=>{e&&this._providePart(e)});{let t=e.body.getReader(),r=()=>t.read().then(({done:e,value:t})=>{if(!(e||this.hasCompleted()))return this._providePart(t.buffer),r()});return r()}}).then(()=>{this.hasCompleted()||this._finalize()}).catch(e=>{if(this.hasCompleted())return;let t=e instanceof n.loaderErrors.LoaderError?e:new n.loaderErrors.LoaderError(e);this._finalize(t)});n.helpers.always(a,()=>window.clearTimeout(o))}static isSupported(){return"fetch"in window&&"Request"in window&&"AbortController"in window&&!_}_abort(){window.clearTimeout(this._abortTimer),this._abortController.abort()}_reduceParts(e){return n.helpers.arrayBuffer.combine(e.map(e=>new Uint8Array(e))).buffer}}class g{constructor({fetchEnabled:e=!0}={}){this._fetchEnabled=e}request({url:e,headers:t,timeout:r}){return this._fetchEnabled&&p.isSupported()?new p(e,t,r):new d(e,t,r)}}let f=new g,y="31.1.0",m=2227;return o})(),e.exports=i(r(18471))},49680:function(e,t,r){var i;"undefined"!=typeof self&&self,i=(e,t)=>(()=>{"use strict";var r,i,o,n,a,s,l=[,t=>{t.exports=e},(e,t,r)=>{e.exports=r(3)()?Map:r(4)},e=>{e.exports=function(){var e,t;if("function"!=typeof Map)return!1;try{e=new Map([["raz","one"],["dwa","two"],["trzy","three"]])}catch(e){return!1}return"[object Map]"===String(e)&&3===e.size&&"function"==typeof e.clear&&"function"==typeof e.delete&&"function"==typeof e.entries&&"function"==typeof e.forEach&&"function"==typeof e.get&&"function"==typeof e.has&&"function"==typeof e.keys&&"function"==typeof e.set&&"function"==typeof e.values&&!1===(t=e.entries().next()).done&&!!t.value&&"raz"===t.value[0]&&"one"===t.value[1]}},(e,t,r)=>{var i,o=r(5),n=r(9),a=r(18),s=r(23),l=r(6),u=r(24),h=r(36),c=r(37),d=r(42),_=r(46),p=r(60),g=r(63),f=Function.prototype.call,y=Object.defineProperties,m=Object.getPrototypeOf;e.exports=i=function(){var e,t,r,o=arguments[0];if(!(this instanceof i))throw TypeError("Constructor requires 'new'");return r=g&&a&&Map!==i?a(new Map,m(this)):this,null!=o&&d(o),y(r,{__mapKeysData__:u("c",e=[]),__mapValuesData__:u("c",t=[])}),o&&_(o,function(r){var i=l(r)[0];r=r[1],-1===n.call(e,i)&&(e.push(i),t.push(r))},r),r},g&&(a&&a(i,Map),i.prototype=Object.create(Map.prototype,{constructor:u(i)})),h(y(i.prototype,{clear:u(function(){this.__mapKeysData__.length&&(o.call(this.__mapKeysData__),o.call(this.__mapValuesData__),this.emit("_clear"))}),delete:u(function(e){var t=n.call(this.__mapKeysData__,e);return -1!==t&&(this.__mapKeysData__.splice(t,1),this.__mapValuesData__.splice(t,1),this.emit("_delete",t,e),!0)}),entries:u(function(){return new p(this,"key+value")}),forEach:u(function(e){var t,r,i=arguments[1];for(s(e),r=(t=this.entries())._next();void 0!==r;)f.call(e,i,this.__mapValuesData__[r],this.__mapKeysData__[r],this),r=t._next()}),get:u(function(e){var t=n.call(this.__mapKeysData__,e);if(-1!==t)return this.__mapValuesData__[t]}),has:u(function(e){return -1!==n.call(this.__mapKeysData__,e)}),keys:u(function(){return new p(this,"key")}),set:u(function(e,t){var r,i=n.call(this.__mapKeysData__,e);return -1===i&&(i=this.__mapKeysData__.push(e)-1,r=!0),this.__mapValuesData__[i]=t,r&&this.emit("_add",i,e),this}),size:u.gs(function(){return this.__mapKeysData__.length}),values:u(function(){return new p(this,"value")}),toString:u(function(){return"[object Map]"})})),Object.defineProperty(i.prototype,c.iterator,u(function(){return this.entries()})),Object.defineProperty(i.prototype,c.toStringTag,u("c","Map"))},(e,t,r)=>{var i=r(6);e.exports=function(){return i(this).length=0,this}},(e,t,r)=>{var i=r(7);e.exports=function(e){if(!i(e))throw TypeError("Cannot use null or undefined");return e}},(e,t,r)=>{var i=r(8)();e.exports=function(e){return e!==i&&null!==e}},e=>{e.exports=function(){}},(e,t,r)=>{var i=r(10),o=r(13),n=r(6),a=Array.prototype.indexOf,s=Object.prototype.hasOwnProperty,l=Math.abs,u=Math.floor;e.exports=function(e){var t,r,h;if(!i(e))return a.apply(this,arguments);for(r=o(n(this).length),h=arguments[1],t=h=isNaN(h)?0:h>=0?u(h):o(this.length)-u(l(h));t<r;++t)if(s.call(this,t)&&i(this[t]))return t;return -1}},(e,t,r)=>{e.exports=r(11)()?Number.isNaN:r(12)},e=>{e.exports=function(){var e=Number.isNaN;return"function"==typeof e&&!e({})&&e(NaN)&&!e(34)}},e=>{e.exports=function(e){return e!=e}},(e,t,r)=>{var i=r(14),o=Math.max;e.exports=function(e){return o(0,i(e))}},(e,t,r)=>{var i=r(15),o=Math.abs,n=Math.floor;e.exports=function(e){return isNaN(e)?0:0!==(e=Number(e))&&isFinite(e)?i(e)*n(o(e)):e}},(e,t,r)=>{e.exports=r(16)()?Math.sign:r(17)},e=>{e.exports=function(){var e=Math.sign;return"function"==typeof e&&1===e(10)&&-1===e(-20)}},e=>{e.exports=function(e){return isNaN(e=Number(e))||0===e?e:e>0?1:-1}},(e,t,r)=>{e.exports=r(19)()?Object.setPrototypeOf:r(20)},e=>{var t=Object.create,r=Object.getPrototypeOf,i={};e.exports=function(){var e=Object.setPrototypeOf,o=arguments[0]||t;return"function"==typeof e&&r(e(o(null),i))===i}},(e,t,r)=>{var i,o,n,a,s=r(21),l=r(6),u=Object.prototype.isPrototypeOf,h=Object.defineProperty,c={configurable:!0,enumerable:!1,writable:!0,value:void 0};a=function(e,t){if(l(e),null===t||s(t))return e;throw TypeError("Prototype must be null or an object")},e.exports=(i=function(){var e,t=Object.create(null),r={},i=Object.getOwnPropertyDescriptor(Object.prototype,"__proto__");if(i){try{(e=i.set).call(t,r)}catch(e){}if(Object.getPrototypeOf(t)===r)return{set:e,level:2}}return(t.__proto__=r,Object.getPrototypeOf(t)===r)?{level:2}:((t={}).__proto__=r,Object.getPrototypeOf(t)===r&&{level:1})}())?(2===i.level?i.set?(n=i.set,o=function(e,t){return n.call(a(e,t),t),e}):o=function(e,t){return a(e,t).__proto__=t,e}:o=function e(t,r){var i;return a(t,r),(i=u.call(e.nullPolyfill,t))&&delete e.nullPolyfill.__proto__,null===r&&(r=e.nullPolyfill),t.__proto__=r,i&&h(e.nullPolyfill,"__proto__",c),t},Object.defineProperty(o,"level",{configurable:!1,enumerable:!1,writable:!1,value:i.level})):null,r(22)},(e,t,r)=>{var i=r(7),o={function:!0,object:!0};e.exports=function(e){return i(e)&&o[typeof e]||!1}},(e,t,r)=>{var i,o,n,a,s=Object.create;r(19)()||(a=r(20)),e.exports=a&&1===a.level?(i={},o={},n={configurable:!1,enumerable:!1,writable:!0,value:void 0},Object.getOwnPropertyNames(Object.prototype).forEach(function(e){if("__proto__"===e){o[e]={configurable:!0,enumerable:!1,writable:!0,value:void 0};return}o[e]=n}),Object.defineProperties(i,o),Object.defineProperty(a,"nullPolyfill",{configurable:!1,enumerable:!1,writable:!1,value:i}),function(e,t){return s(null===e?i:e,t)}):s},e=>{e.exports=function(e){if("function"!=typeof e)throw TypeError(e+" is not a function");return e}},(e,t,r)=>{var i=r(25),o=r(31),n=r(32),a=r(33);(e.exports=function(e,t){var r,n,s,l,u;return arguments.length<2||"string"!=typeof e?(l=t,t=e,e=null):l=arguments[2],null==e?(r=s=!0,n=!1):(r=a.call(e,"c"),n=a.call(e,"e"),s=a.call(e,"w")),u={value:t,configurable:r,enumerable:n,writable:s},l?i(o(l),u):u}).gs=function(e,t,r){var s,l,u,h;return"string"!=typeof e?(u=r,r=t,t=e,e=null):u=arguments[3],null==t?t=void 0:n(t)?null==r?r=void 0:n(r)||(u=r,r=void 0):(u=t,t=r=void 0),null==e?(s=!0,l=!1):(s=a.call(e,"c"),l=a.call(e,"e")),h={get:t,set:r,configurable:s,enumerable:l},u?i(o(u),h):h}},(e,t,r)=>{e.exports=r(26)()?Object.assign:r(27)},e=>{e.exports=function(){var e,t=Object.assign;return"function"==typeof t&&(t(e={foo:"raz"},{bar:"dwa"},{trzy:"trzy"}),e.foo+e.bar+e.trzy==="razdwatrzy")}},(e,t,r)=>{var i=r(28),o=r(6),n=Math.max;e.exports=function(e,t){var r,a,s,l=n(arguments.length,2);for(a=1,e=Object(o(e)),s=function(i){try{e[i]=t[i]}catch(e){r||(r=e)}};a<l;++a)t=arguments[a],i(t).forEach(s);if(void 0!==r)throw r;return e}},(e,t,r)=>{e.exports=r(29)()?Object.keys:r(30)},e=>{e.exports=function(){try{return Object.keys("primitive"),!0}catch(e){return!1}}},(e,t,r)=>{var i=r(7),o=Object.keys;e.exports=function(e){return o(i(e)?Object(e):e)}},(e,t,r)=>{var i=r(7),o=Array.prototype.forEach,n=Object.create,a=function(e,t){var r;for(r in e)t[r]=e[r]};e.exports=function(e){var t=n(null);return o.call(arguments,function(e){i(e)&&a(Object(e),t)}),t}},e=>{e.exports=function(e){return"function"==typeof e}},(e,t,r)=>{e.exports=r(34)()?String.prototype.contains:r(35)},e=>{var t="razdwatrzy";e.exports=function(){return"function"==typeof t.contains&&!0===t.contains("dwa")&&!1===t.contains("foo")}},e=>{var t=String.prototype.indexOf;e.exports=function(e){return t.call(this,e,arguments[1])>-1}},(e,t,r)=>{var i,o,n,a,s,l,u,h=r(24),c=r(23),d=Function.prototype.apply,_=Function.prototype.call,p=Object.create,g=Object.defineProperty,f=Object.defineProperties,y=Object.prototype.hasOwnProperty,m={configurable:!0,enumerable:!1,writable:!0};i=function(e,t){var r;return c(t),y.call(this,"__ee__")?r=this.__ee__:(r=m.value=p(null),g(this,"__ee__",m),m.value=null),r[e]?"object"==typeof r[e]?r[e].push(t):r[e]=[r[e],t]:r[e]=t,this},o=function(e,t){var r,o;return c(t),o=this,i.call(this,e,r=function(){n.call(o,e,r),d.call(t,this,arguments)}),r.__eeOnceListener__=t,this},s={on:i,once:o,off:n=function(e,t){var r,i,o,n;if(c(t),!y.call(this,"__ee__")||!(r=this.__ee__)[e])return this;if("object"==typeof(i=r[e]))for(n=0;o=i[n];++n)(o===t||o.__eeOnceListener__===t)&&(2===i.length?r[e]=i[n?0:1]:i.splice(n,1));else(i===t||i.__eeOnceListener__===t)&&delete r[e];return this},emit:a=function(e){var t,r,i,o,n;if(y.call(this,"__ee__")&&(o=this.__ee__[e])){if("object"==typeof o){for(t=1,r=arguments.length,n=Array(r-1);t<r;++t)n[t-1]=arguments[t];for(t=0,o=o.slice();i=o[t];++t)d.call(i,this,n)}else switch(arguments.length){case 1:_.call(o,this);break;case 2:_.call(o,this,arguments[1]);break;case 3:_.call(o,this,arguments[1],arguments[2]);break;default:for(t=1,r=arguments.length,n=Array(r-1);t<r;++t)n[t-1]=arguments[t];d.call(o,this,n)}}}},u=f({},l={on:h(i),once:h(o),off:h(n),emit:h(a)}),e.exports=t=function(e){return null==e?p(u):f(Object(e),l)},t.methods=s},(e,t,r)=>{e.exports=r(38)()?Symbol:r(39)},e=>{var t={object:!0,symbol:!0};e.exports=function(){var e;if("function"!=typeof Symbol)return!1;e=Symbol("test symbol");try{String(e)}catch(e){return!1}return!!t[typeof Symbol.iterator]&&!!t[typeof Symbol.toPrimitive]&&!!t[typeof Symbol.toStringTag]}},(e,t,r)=>{var i,o,n,a,s,l=r(24),u=r(40),h=Object.create,c=Object.defineProperties,d=Object.defineProperty,_=Object.prototype,p=h(null);if("function"==typeof Symbol){o=Symbol;try{String(o()),s=!0}catch(e){}}var g=(i=h(null),function(e){for(var t,r,o=0;i[e+(o||"")];)++o;return i[e+=o||""]=!0,d(_,t="@@"+e,l.gs(null,function(e){r||(r=!0,d(this,t,l(e)),r=!1)})),t});a=function(e){if(this instanceof a)throw TypeError("Symbol is not a constructor");return n(e)},e.exports=n=function e(t){if(this instanceof e)throw TypeError("Symbol is not a constructor");return s?o(t):c(h(a.prototype),{__description__:l("",t=void 0===t?"":String(t)),__name__:l("",g(t))})},c(n,{for:l(function(e){return p[e]?p[e]:p[e]=n(String(e))}),keyFor:l(function(e){var t;for(t in u(e),p)if(p[t]===e)return t}),hasInstance:l("",o&&o.hasInstance||n("hasInstance")),isConcatSpreadable:l("",o&&o.isConcatSpreadable||n("isConcatSpreadable")),iterator:l("",o&&o.iterator||n("iterator")),match:l("",o&&o.match||n("match")),replace:l("",o&&o.replace||n("replace")),search:l("",o&&o.search||n("search")),species:l("",o&&o.species||n("species")),split:l("",o&&o.split||n("split")),toPrimitive:l("",o&&o.toPrimitive||n("toPrimitive")),toStringTag:l("",o&&o.toStringTag||n("toStringTag")),unscopables:l("",o&&o.unscopables||n("unscopables"))}),c(a.prototype,{constructor:l(n),toString:l("",function(){return this.__name__})}),c(n.prototype,{toString:l(function(){return"Symbol ("+u(this).__description__+")"}),valueOf:l(function(){return u(this)})}),d(n.prototype,n.toPrimitive,l("",function(){var e=u(this);return"symbol"==typeof e?e:e.toString()})),d(n.prototype,n.toStringTag,l("c","Symbol")),d(a.prototype,n.toStringTag,l("c",n.prototype[n.toStringTag])),d(a.prototype,n.toPrimitive,l("c",n.prototype[n.toPrimitive]))},(e,t,r)=>{var i=r(41);e.exports=function(e){if(!i(e))throw TypeError(e+" is not a symbol");return e}},e=>{e.exports=function(e){return!!e&&("symbol"==typeof e||!!e.constructor&&"Symbol"===e.constructor.name&&"Symbol"===e[e.constructor.toStringTag])}},(e,t,r)=>{var i=r(43);e.exports=function(e){if(!i(e))throw TypeError(e+" is not iterable");return e}},(e,t,r)=>{var i=r(44),o=r(7),n=r(45),a=r(37).iterator,s=Array.isArray;e.exports=function(e){return!!o(e)&&(!!(s(e)||n(e)||i(e))||"function"==typeof e[a])}},e=>{var t=Object.prototype.toString,r=t.call(function(){return arguments}());e.exports=function(e){return t.call(e)===r}},e=>{var t=Object.prototype.toString,r=t.call("");e.exports=function(e){return"string"==typeof e||e&&"object"==typeof e&&(e instanceof String||t.call(e)===r)||!1}},(e,t,r)=>{var i=r(44),o=r(23),n=r(45),a=r(47),s=Array.isArray,l=Function.prototype.call,u=Array.prototype.some;e.exports=function(e,t){var r,h,c,d,_,p,g,f,y=arguments[2];if(s(e)||i(e)?r="array":n(e)?r="string":e=a(e),o(t),c=function(){d=!0},"array"===r){u.call(e,function(e){return l.call(t,y,e,c),d});return}if("string"===r){for(_=0,p=e.length;_<p&&(g=e[_],_+1<p&&(f=g.charCodeAt(0))>=55296&&f<=56319&&(g+=e[++_]),l.call(t,y,g,c),!d);++_);return}for(h=e.next();!h.done;){if(l.call(t,y,h.value,c),d)return;h=e.next()}}},(e,t,r)=>{var i=r(44),o=r(45),n=r(48),a=r(59),s=r(42),l=r(37).iterator;e.exports=function(e){return"function"==typeof s(e)[l]?e[l]():i(e)?new n(e):o(e)?new a(e):new n(e)}},(e,t,r)=>{var i,o=r(18),n=r(33),a=r(24),s=r(37),l=r(49),u=Object.defineProperty;i=e.exports=function(e,t){if(!(this instanceof i))throw TypeError("Constructor requires 'new'");l.call(this,e),u(this,"__kind__",a("",t=t?n.call(t,"key+value")?"key+value":n.call(t,"key")?"key":"value":"value"))},o&&o(i,l),delete i.prototype.constructor,i.prototype=Object.create(l.prototype,{_resolve:a(function(e){return"value"===this.__kind__?this.__list__[e]:"key+value"===this.__kind__?[e,this.__list__[e]]:e})}),u(i.prototype,s.toStringTag,a("c","Array Iterator"))},(e,t,r)=>{var i,o=r(5),n=r(25),a=r(23),s=r(6),l=r(24),u=r(50),h=r(37),c=Object.defineProperty,d=Object.defineProperties;e.exports=i=function(e,t){if(!(this instanceof i))throw TypeError("Constructor requires 'new'");d(this,{__list__:l("w",s(e)),__context__:l("w",t),__nextIndex__:l("w",0)}),t&&(a(t.on),t.on("_add",this._onAdd),t.on("_delete",this._onDelete),t.on("_clear",this._onClear))},delete i.prototype.constructor,d(i.prototype,n({_next:l(function(){var e;if(this.__list__){if(this.__redo__&&void 0!==(e=this.__redo__.shift()))return e;if(this.__nextIndex__<this.__list__.length)return this.__nextIndex__++;this._unBind()}}),next:l(function(){return this._createResult(this._next())}),_createResult:l(function(e){return void 0===e?{done:!0,value:void 0}:{done:!1,value:this._resolve(e)}}),_resolve:l(function(e){return this.__list__[e]}),_unBind:l(function(){this.__list__=null,delete this.__redo__,this.__context__&&(this.__context__.off("_add",this._onAdd),this.__context__.off("_delete",this._onDelete),this.__context__.off("_clear",this._onClear),this.__context__=null)}),toString:l(function(){return"[object "+(this[h.toStringTag]||"Object")+"]"})},u({_onAdd:l(function(e){if(!(e>=this.__nextIndex__)){if(++this.__nextIndex__,!this.__redo__){c(this,"__redo__",l("c",[e]));return}this.__redo__.forEach(function(t,r){t>=e&&(this.__redo__[r]=++t)},this),this.__redo__.push(e)}}),_onDelete:l(function(e){var t;!(e>=this.__nextIndex__)&&(--this.__nextIndex__,this.__redo__&&(-1!==(t=this.__redo__.indexOf(e))&&this.__redo__.splice(t,1),this.__redo__.forEach(function(t,r){t>e&&(this.__redo__[r]=--t)},this)))}),_onClear:l(function(){this.__redo__&&o.call(this.__redo__),this.__nextIndex__=0})}))),c(i.prototype,h.iterator,l(function(){return this}))},(e,t,r)=>{var i,o=r(51),n=r(31),a=r(23),s=r(56),l=r(23),u=r(6),h=Function.prototype.bind,c=Object.defineProperty,d=Object.prototype.hasOwnProperty;i=function(e,t,r){var i,n=u(t)&&l(t.value);return i=o(t),delete i.writable,delete i.value,i.get=function(){return!r.overwriteDefinition&&d.call(this,e)?n:(t.value=h.call(n,r.resolveContext?r.resolveContext(this):this),c(this,e,t),this[e])},i},e.exports=function(e){var t=n(arguments[1]);return null!=t.resolveContext&&a(t.resolveContext),s(e,function(e,r){return i(r,e,t)})}},(e,t,r)=>{var i=r(52),o=r(25),n=r(6);e.exports=function(e){var t=Object(n(e)),r=arguments[1],a=Object(arguments[2]);if(t!==e&&!r)return t;var s={};return r?i(r,function(t){(a.ensure||t in e)&&(s[t]=e[t])}):o(s,e),s}},(e,t,r)=>{e.exports=r(53)()?Array.from:r(54)},e=>{e.exports=function(){var e,t,r=Array.from;return"function"==typeof r&&!!((t=r(e=["raz","dwa"]))&&t!==e&&"dwa"===t[1])}},(e,t,r)=>{var i=r(37).iterator,o=r(44),n=r(55),a=r(13),s=r(23),l=r(6),u=r(7),h=r(45),c=Array.isArray,d=Function.prototype.call,_={configurable:!0,enumerable:!0,writable:!0,value:null},p=Object.defineProperty;e.exports=function(e){var t,r,g,f,y,m,v,b,E,x,w=arguments[1],P=arguments[2];if(e=Object(l(e)),u(w)&&s(w),this&&this!==Array&&n(this))t=this;else{if(!w){if(o(e))return 1!==(y=e.length)?Array.apply(null,e):((f=[,])[0]=e[0],f);if(c(e)){for(r=0,f=Array(y=e.length);r<y;++r)f[r]=e[r];return f}}f=[]}if(!c(e)){if(void 0!==(E=e[i])){for(v=s(E).call(e),t&&(f=new t),b=v.next(),r=0;!b.done;)x=w?d.call(w,P,b.value,r):b.value,t?(_.value=x,p(f,r,_)):f[r]=x,b=v.next(),++r;y=r}else if(h(e)){for(y=e.length,t&&(f=new t),r=0,g=0;r<y;++r)x=e[r],r+1<y&&(m=x.charCodeAt(0))>=55296&&m<=56319&&(x+=e[++r]),x=w?d.call(w,P,x,g):x,t?(_.value=x,p(f,g,_)):f[g]=x,++g;y=g}}if(void 0===y)for(y=a(e.length),t&&(f=new t(y)),r=0;r<y;++r)x=w?d.call(w,P,e[r],r):e[r],t?(_.value=x,p(f,r,_)):f[r]=x;return t&&(_.value=null,f.length=y),f}},(e,t,r)=>{var i=Object.prototype.toString,o=i.call(r(8));e.exports=function(e){return"function"==typeof e&&i.call(e)===o}},(e,t,r)=>{var i=r(23),o=r(57),n=Function.prototype.call;e.exports=function(e,t){var r={},a=arguments[2];return i(t),o(e,function(e,i,o,s){r[i]=n.call(t,a,e,i,o,s)}),r}},(e,t,r)=>{e.exports=r(58)("forEach")},(e,t,r)=>{var i=r(23),o=r(6),n=Function.prototype.bind,a=Function.prototype.call,s=Object.keys,l=Object.prototype.propertyIsEnumerable;e.exports=function(e,t){return function(r,u){var h,c=arguments[2],d=arguments[3];return r=Object(o(r)),i(u),h=s(r),d&&h.sort("function"==typeof d?n.call(d,r):void 0),"function"!=typeof e&&(e=h[e]),a.call(e,h,function(e,i){return l.call(r,e)?a.call(u,c,r[e],e,r,i):t})}}},(e,t,r)=>{var i,o=r(18),n=r(24),a=r(37),s=r(49),l=Object.defineProperty;i=e.exports=function(e){if(!(this instanceof i))throw TypeError("Constructor requires 'new'");e=String(e),s.call(this,e),l(this,"__length__",n("",e.length))},o&&o(i,s),delete i.prototype.constructor,i.prototype=Object.create(s.prototype,{_next:n(function(){if(this.__list__){if(this.__nextIndex__<this.__length__)return this.__nextIndex__++;this._unBind()}}),_resolve:n(function(e){var t,r=this.__list__[e];return this.__nextIndex__===this.__length__?r:(t=r.charCodeAt(0))>=55296&&t<=56319?r+this.__list__[this.__nextIndex__++]:r})}),l(i.prototype,a.toStringTag,n("c","String Iterator"))},(e,t,r)=>{var i,o=r(18),n=r(24),a=r(49),s=r(37).toStringTag,l=r(61),u=Object.defineProperties,h=a.prototype._unBind;i=e.exports=function(e,t){if(!(this instanceof i))return new i(e,t);a.call(this,e.__mapKeysData__,e),t&&l[t]||(t="key+value"),u(this,{__kind__:n("",t),__values__:n("w",e.__mapValuesData__)})},o&&o(i,a),i.prototype=Object.create(a.prototype,{constructor:n(i),_resolve:n(function(e){return"value"===this.__kind__?this.__values__[e]:"key"===this.__kind__?this.__list__[e]:[this.__list__[e],this.__values__[e]]}),_unBind:n(function(){this.__values__=null,h.call(this)}),toString:n(function(){return"[object Map Iterator]"})}),Object.defineProperty(i.prototype,s,n("c","Map Iterator"))},(e,t,r)=>{e.exports=r(62)("key","value","key+value")},e=>{var t=Array.prototype.forEach,r=Object.create;e.exports=function(e){var i=r(null);return t.call(arguments,function(e){i[e]=!0}),i}},e=>{e.exports="undefined"!=typeof Map&&"[object Map]"===Object.prototype.toString.call(new Map)},e=>{e.exports=t}],u={};function h(e){var t=u[e];if(void 0!==t)return t.exports;var r=u[e]={exports:{}};return l[e](r,r.exports,h),r.exports}h.d=(e,t)=>{for(var r in t)h.o(t,r)&&!h.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},h.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),h.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})};var c={};function d(e){return new _({startPos:e,endPos:0,startLevel:1,endLevel:0,fromEnd:!0})}h.r(c),h.d(c,{BaseController:()=>f,BaseStreamUrlRetriever:()=>p,DecayingExponentialDelayCalculator:()=>b,FairPlayManager:()=>es,Limiter:()=>x,Player:()=>eo,Quality:()=>a,UrlRetrieverError:()=>v,allRenditions:()=>m,buildNumber:()=>eh,errors:()=>s,getGlobalMuted:()=>er,getGlobalVolume:()=>ee,notSupportedError:()=>g,renditions:()=>y,resolveQuality:()=>el,setCacheSize:()=>ei,setGlobalMuted:()=>et,setGlobalVolume:()=>Z,version:()=>eu,volumeAutomation:()=>n});class _{constructor({startPos:e,endPos:t,startLevel:r,endLevel:i,fromEnd:o=!1}){if(e<0)throw Error("startPos invalid.");if(t<0||!o&&t<e||o&&e<t)throw Error("endPos invalid.");if(r<0||r>1)throw Error("startLevel invalid.");if(i<0||i>1)throw Error("endLevel invalid.");this._startPos=e,this._endPos=t,this._startLevel=r,this._endLevel=i,this._fromEnd=o}calculate(e,t){let r=this._fromEnd?t-500-this._startPos:this._startPos,i=this._fromEnd?t-500-this._endPos:this._endPos;return e<r?{level:this._startLevel,nextCalculatePosition:r-e}:e<=i?{level:this._startLevel+(this._endLevel-this._startLevel)*(-(Math.cos((e-r)/(i-r)*Math.PI)/2)+.5),nextCalculatePosition:e}:{level:this._endLevel,nextCalculatePosition:1/0}}}(r=n||(n={})).Fade=_,r.buildFadeIn=function(e){return new _({startPos:0,endPos:e,startLevel:0,endLevel:1,fromEnd:!1})},r.buildFadeOut=d;class p{}let g=Error("Not supported.");class f{constructor(){this.supportsVolumeAutomation=!0,this.syncConfig={}}}let y={httpMp3:{scProtocol:"http",scFormat:"mp3",maestroFormat:{mimeType:"audio/mpeg"}},httpAACHQ:{scProtocol:"http",scFormat:"aac",maestroFormat:{mimeType:"audio/mp4",audioCodec:{id:"mp4a.40.2"}}},hlsMp3:{scProtocol:"hls",scFormat:"mp3",maestroFormat:{mimeType:"application/x-mpegURL"},maestroSegmentFormat:{mimeType:"audio/mpeg"}},encryptedHlsMp3:{scProtocol:"encrypted-hls",scFormat:"mp3",maestroFormat:{mimeType:"application/x-mpegURL"},maestroSegmentFormat:{mimeType:"audio/mpeg"}},hlsOpus:{scProtocol:"hls",scFormat:"opus",maestroFormat:{mimeType:"application/x-mpegURL"},maestroSegmentFormat:{mimeType:"audio/ogg",audioCodec:{id:"opus"}}},encryptedHlsOpus:{scProtocol:"encrypted-hls",scFormat:"opus",maestroFormat:{mimeType:"application/x-mpegURL"},maestroSegmentFormat:{mimeType:"audio/ogg",audioCodec:{id:"opus"}}},hlsAACHQ:{scProtocol:"hls",scFormat:"aac",maestroFormat:{mimeType:"application/x-mpegURL"},maestroSegmentFormat:{mimeType:"audio/mp4",audioCodec:{id:"mp4a.40.2"}}},encryptedHlsAACHQ:{scProtocol:"encrypted-hls",scFormat:"aac",maestroFormat:{mimeType:"application/x-mpegURL"},maestroSegmentFormat:{mimeType:"audio/mp4",audioCodec:{id:"mp4a.40.2"}}},ctrEncryptedHlsAAC:{scProtocol:"ctr-encrypted-hls",scFormat:"aac",maestroFormat:{mimeType:"application/x-mpegURL"},maestroSegmentFormat:{mimeType:"audio/mp4",audioCodec:{id:"mp4a.40.2"}}},cbcEncryptedHlsAAC:{scProtocol:"cbc-encrypted-hls",scFormat:"aac",maestroFormat:{mimeType:"application/x-mpegURL"},maestroSegmentFormat:{mimeType:"audio/mp4",audioCodec:{id:"mp4a.40.2"}}},apiMobile:{scProtocol:"sc.api-mobile",maestroFormat:{}},maestroChromecast:{scProtocol:"maestro.chromecast",maestroFormat:{}}},m=Object.keys(y).map(e=>y[e]);class v extends Error{constructor(e="UNKNOWN",t=!1,r=null){super(`UrlRetrieverError: ${e}`),this._code=e,this._transient=t,this._cause=r}isTransient(){return this._transient}getCode(){return this._code}getCause(){return this._cause}}class b{constructor(){this._delayFactor=0,this._lastRequestTime=0}getDelay({maxDelay:e=3e4,numInstantRuns:t=5}={}){let r=Date.now()-this._lastRequestTime;this._lastRequestTime=Date.now(),this._delayFactor=Math.max(0,this._delayFactor-r/e),this._delayFactor++;let i=this._delayFactor-t;return i>0?Math.pow(2,i):0}registerSuccess(){this._delayFactor=Math.max(0,this._delayFactor-2)}}var E=h(1);class x{constructor(){this._jobs=[],this._calculator=new b,this._jobWaiting=!1}execute(e){let t={job:e};return this._jobs.push(t),this._executeNextJob(),{abort:()=>{let e=this._jobs.indexOf(t);e>=0&&this._jobs.splice(e,1)}}}_executeNextJob(){if(!this._jobWaiting){let e=this._jobs.shift();if(e){let t=()=>{this._jobWaiting=!1,this._executeNextJob()},r=this._calculator.getDelay();this._jobWaiting=!0,E.helpers.deferException(()=>{e.job().then(()=>{this._calculator.registerSuccess()})}),0===r?t():window.setTimeout(t,r)}}}}class w{constructor(e=200){this._bufferSize=e,this._log=[]}getLog(){return this._log.map(e=>Object.assign(Object.assign({},e),{data:e.data.map(e=>{try{return JSON.stringify(e)}catch(e){return"<unavailable>"}})}))}debug(e,...t){this._push({level:"debug",msg:e,data:t,time:Date.now()})}info(e,...t){this._push({level:"info",msg:e,data:t,time:Date.now()})}warn(e,...t){this._push({level:"warn",msg:e,data:t,time:Date.now()})}error(e,...t){this._push({level:"error",msg:e,data:t,time:Date.now()})}_push(e){this._log.push(e)>this._bufferSize&&this._log.shift()}}let P=E.helpers.time.now;class R{constructor(){this._start=null,this._end=null}start(){if(this.isComplete())throw Error("Timer completed.");this._start=P()}isComplete(){return null!==this._end}stop(){if(null===this._start)throw Error("Not started.");this._end=P()}getTime(){if(null===this._end)throw Error("Not completed.");return this._end-this._start}}let O=E.helpers.find;class S{constructor({proxy:e,getPlayer:t}){this._getPlayer=t;let r=e.getPosition(),i=this._initialActualPlayer=t();if(i){let e=function(e,t){let r=e.getBufferedTimeRanges();return r?O(r,e=>e.containsTime(t))||new E.TimeRange(t,0):null}(i,r);e?this._initialBuffered=e.end-r:this._initialBuffered=null}else this._initialBuffered=null}getPreloaded(){let e=this._initialBuffered;return null!==e&&this._initialActualPlayer&&this._getPlayer()===this._initialActualPlayer?0===e?"no":e>=2e3?"yes":"partial":null}}function C(){switch(window.document.hidden){case!0:return"background";case!1:return"foreground";default:return}}class T{constructor(e,t,r,i,o){this._logger=E.logger.prefixLogger(i,"AudioPerformanceEventGenerator"),this._proxy=e,this._getPlayer=t,this._eventReporter=r,this._getPlayerDetails=o,this._measureGeneralEvents()}reportManualEvent(e){this._logger.debug("Reporting manual audio performance event.",e),this._eventReporter(e)}_measureGeneralEvents(){let e=this._proxy,t=null,r=null,i=null,o=null,n=null,a=null,s=null,l=!0;e.onChange.subscribe(({playing:u,actuallyPlaying:h,seek:c,seeking:d,stalled:_,ended:p,dead:g})=>{if((!0===g||!1===u)&&o&&(o.stop(),o.getTime()>=1e3&&this._reportEvent("rageSkip",o.getTime(),null),o=null),e.isDead()){s&&window.clearTimeout(s);return}let f=e.getSeekState();!e.isActuallyPlaying()&&!o&&(!0===u||e.isPlaying()&&!0===_)&&(o=new R).start(),!0!==u||t||((t=new R).start(),r=new S({proxy:e,getPlayer:this._getPlayer}),s=window.setTimeout(()=>{this._reportEvent("longInitialBuffering",0,null)},3e4),0!==e.getPosition()||(l=!1)),!1===u&&(s&&window.clearTimeout(s),t&&!t.isComplete()&&(t=null)),!0===h&&(o=null,t&&!t.isComplete()&&(t.stop(),s&&window.clearTimeout(s),this._reportEvent("play",t.getTime(),r.getPreloaded()))),c&&"IN_PROGRESS"===c.state&&e.isReady()&&((i=new R).start(),n=new S({proxy:e,getPlayer:this._getPlayer}),!0===d&&this._reportEvent("seekStart",0,null)),(c&&"COMPLETED"===c.state&&!e.isStalled()||!1===_&&f&&"COMPLETED"===f.state)&&i&&(i.stop(),this._reportEvent("seek",i.getTime(),n.getPreloaded()),i=null),!0===_&&e.isPlaying()&&(!f||"IN_PROGRESS"!==f.state)&&t&&t.isComplete()&&((a=new R).start(),this._reportEvent("rebufferingStart",e.getPosition(),null)),!1===_&&(t&&t.isComplete()&&(o=null),a&&(a.stop(),this._reportEvent("rebufferingEnd",a.getTime(),null),a=null)),!0!==p||l||(this._reportEvent("uninterruptedPlay",0,null),l=!0),!(f&&"IN_PROGRESS"===f.state)&&!0===_&&e.isActuallyPlaying()&&(l=!0)})}_reportEvent(e,t,r){let i=this._getPlayerDetails();if(!i){this._logger.warn("Cannot report event because there is no player.",e,t);return}let o={type:e,latency:t,protocol:i.protocol,playerType:i.name,host:i.host,bitrate:i.bitrate,format:i.format,preset:i.preset,quality:i.quality,preloaded:r||void 0,appState:C()};this._logger.debug("Generated audio performance event.",o),this._eventReporter(o)}}class L{constructor(e,t,r,i,o,n){this._logger=E.logger.prefixLogger(n,"ErrorGenerator"),this._player=e,this._logCollector=t,this._logId=r,this._trackId=i,this._eventReporter=o,this._listenForProxyFatalError()}reportManualEvent(e,t){"NOT_SUPPORTED_ERROR"!==e&&"HLS_MSE_PLAYER.NO_TRANSMUXER_ERROR"!==e&&(this._logger.debug("Reporting manual error event.",e),this._reportEvent(e,t))}_listenForProxyFatalError(){this._player.onError.subscribe(e=>{e instanceof E.errors.PlayerFatalError&&this._reportEvent(e.getCode())})}_reportEvent(e,t){let r={errorCode:e,log:this._logCollector.getLog(),logId:this._logId,trackId:this._trackId,protocol:t&&t.protocol?t.protocol:void 0,playerType:t&&t.name?t.name:"MaestroUnknown",host:t&&t.host,bitrate:t&&t.bitrate,format:t&&t.format?t.format:void 0,preset:t&&t.preset,quality:t&&t.quality,url:t&&t.url,appState:C()};this._logger.debug("Generated audio error event.",r),this._eventReporter(r)}}class A{constructor(e,t,r,i,o){this._checkpointTimer=null,this._logger=E.logger.prefixLogger(i,"AudioEventGenerator"),this._player=e,this._eventReporter=t,this._checkpointInterval=Math.max(1e3,r),this._getPlayerDetails=o,this._startReporting()}_startReporting(){let e=this._player;e.onChange.subscribe(({actuallyPlaying:t,ended:r})=>{!0===t&&!e.isEnded()||!1===r&&e.isActuallyPlaying()?(this._checkpointTimer||(this._checkpointTimer=window.setInterval(()=>{this._reportEvent("checkpoint")},this._checkpointInterval)),this._reportEvent("play")):(!1===t&&!e.isEnded()||!0===r&&e.isActuallyPlaying())&&(this._checkpointTimer&&(window.clearInterval(this._checkpointTimer),this._checkpointTimer=null),this._reportEvent("pause"))})}_reportEvent(e){let t=this._getPlayerDetails();if(!t){this._logger.warn("Cannot report event because there is no player.",e);return}let r=this._player.getDuration();if(null===r)throw Error("Duration should exist now.");let i={type:e,position:this._player.getPosition(),duration:r,preset:t.preset,quality:t.quality,playerType:t.name,appState:C()};this._logger.debug("Generated audio event.",i),this._eventReporter(i)}}var M=h(2);let U=/^[^?#]*/;function k(e,t,r){return{name:t.name,preset:e.preset,bitrate:e.bitrate,protocol:e.rendition.scProtocol,host:function(e){let t=e.split("//",2);return 1===t.length?t[0].split("/",1)[0]:t[1]?t[1].split("/",1)[0]:""}(r),url:function(e){let t=U.exec(e);return t&&t[0]||""}(r),format:e.rendition.scFormat,quality:e.quality}}class D{constructor({logger:e,seekStrategy:t,controllers:r,playerId:i,streamUrlsExpire:o,fetchEnabled:n,fadeOnPauseAndPlay:a,fadeOnSeek:s,cacheManager:l,providePlayer:u,removePlayer:h,streamUrlRetriever:c,getURLOpts:d,errorEventGenerator:_,audioPerformanceEventGenerator:p,useIphoneHlsHack:g,fairPlayManager:f,applicationId:y}){this._quality=null,this._onQualityChanged=new E.eventDispatcher.EventDispatcher,this._controllerIndexByRendition=new M,this._controlledPlayerWithRendition=null,this.onQualityChanged=this._onQualityChanged.getHandle(),this._logger=E.logger.prefixLogger(e,"ControllerManager"),this._seekStrategy=t,this._controllers=r,this._playerId=i,this._streamUrlsExpire=o,this._fetchEnabled=n,this._fadeOnPauseAndPlay=a,this._fadeOnSeek=s,this._useIphoneHlsHack=g,this._fairPlayManager=f,this._applicationId=y,this._cacheManager=l,this._providePlayer=u,this._removePlayer=h,this._streamUrlRetriever=c,this._getURLOpts=d,this._errorEventGenerator=_||null,this._audioPerformanceEventGenerator=p||null}buildNextController(e,t){if(this._controlledPlayerWithRendition)throw Error("A player is already being controlled.");this._logger.debug("Building next controller.");let r=this._controllerIndexByRendition.get(e.rendition)||0;if(r>=this._controllers.length)this._logger.debug("No more controllers for this rendition."),t({excludeRendition:!0,immediateRetry:!0});else{let i=!1;this._manageController(e,this._controllers[r],o=>{if(i)throw Error("performNextAction() already called");i=!0,("MOVE_ON"===o||"MOVE_ON_SAME_RENDITION"===o)&&(this._logger.debug("Controller will not be used again."),this._controllerIndexByRendition.set(e.rendition,r+1)),"MOVE_ON_SAME_RENDITION"===o?this.buildNextController(e,t):t({excludeRendition:!1,immediateRetry:"MOVE_ON"===o})})}}releaseCurrentController({retry:e}){if(!this._controlledPlayerWithRendition)throw Error("There is no player being controlled.");this._controlledPlayerWithRendition.releaseControl({retry:e})}getQuality(){return this._quality}getPlayerDetails(){if(!this._controlledPlayerWithRendition)throw Error("There is no player being controlled.");let{initialUrlAndRendition:e,controller:t,controlledPlayer:r}=this._controlledPlayerWithRendition;return k(e,t,r.getUrl())}_manageController(e,t,r){let i;let o=()=>{this._removePlayer(),this._controlledPlayerWithRendition=null,i&&i.kill()};if(this._logger.debug("Preparing controller.",t.name),!t.isRenditionSupported(e.rendition,{streamUrlExpires:this._streamUrlsExpire},{useIphoneHlsHack:this._useIphoneHlsHack,fairPlayManager:this._fairPlayManager})){this._logger.debug("Skipping controller because rendition not supported."),r("MOVE_ON_SAME_RENDITION");return}let n=!1,a=({retry:e})=>{n||(n=!0,this._logger.debug("Releasing control."),o(),r(e?"RETRY":"MOVE_ON"))};try{this._logger.debug("Building player.");let o=t.buildPlayer({logger:E.logger.prefixLogger(this._logger,`${t.name}-Controller`),seekStrategy:this._seekStrategy,playerId:this._playerId,urlAndRendition:e,streamUrlExpires:this._streamUrlsExpire,fetchEnabled:this._fetchEnabled,releaseControl:a,fadeOnPauseAndPlay:this._fadeOnPauseAndPlay,fadeOnSeek:this._fadeOnSeek,useIphoneHlsHack:this._useIphoneHlsHack,fairPlayManager:this._fairPlayManager,applicationId:this._applicationId,getNewUrl:()=>this._getNewUrlWithSameRendition(e.rendition),reportError:r=>{this._errorEventGenerator&&this._errorEventGenerator.reportManualEvent(r,k(e,t,o?o.getUrl():e.url))},reportPerformance:e=>{!n&&this._audioPerformanceEventGenerator&&this._audioPerformanceEventGenerator.reportManualEvent(e)}});if(i=o.getPlayer(),n)this._logger.warn("Player released during constrution."),i.kill();else if(i.isDead()){let e=i.getFatalError();e instanceof E.errors.NotSupportedError?this._logger.debug("Player not supported (during construction)."):this._logger.error("Error during construction.",e),r("MOVE_ON_SAME_RENDITION")}else{this._logger.debug("Player built."),i.onChange.subscribe(({dead:e,fatalError:t})=>{e&&(t&&this._logger.error("Fatal player error occurred.",t),a({retry:!1}))}),this._cacheManager.addPlayer(i),this._controlledPlayerWithRendition={controller:t,controlledPlayer:o,initialUrlAndRendition:e,releaseControl:a},this._providePlayer(o.getPlayer(),t.syncConfig,t.supportsVolumeAutomation),this._logger.debug("Player provided to proxy.");let r=e.quality||null;this._quality!==r&&(this._logger.debug("Quality changed.",r),this._quality=r,this._onQualityChanged.dispatch(r))}}catch(e){e===g?this._logger.debug("Player not supported. Not constructed."):this._logger.error("Error during construction.",e),o(),r("MOVE_ON_SAME_RENDITION")}}_getNewUrlWithSameRendition(e){return new E.helpers.abortableJob.AbortableJob(()=>{let t=this._streamUrlRetriever.getUrl(this._getURLOpts);return{result:t.whenComplete().then(t=>{let r=null;return t&&t.success&&t.rendition===e&&(r=t.url),r}),abort:()=>t.abort()}}).run()}}function I(e,t){let r=e.getMemoryCacheController();r&&r.setMaxCacheSize(t)}class j{constructor(e,t){this._maxCacheSize=e,this._players=[],this._updateTimer=null,this._logger=E.logger.prefixLogger(t,"CacheManager"),this._logger.debug(`Initialized with cache size ${e} bytes.`)}setCacheSize(e){this._maxCacheSize!==e&&(this._logger.debug(`Updating cache size to ${e} bytes.`),this._maxCacheSize=e,this._update())}addPlayer(e){if(this._logger.debug("Adding player to cache manager."),e.isDead()){this._logger.debug("Player was dead.");return}let t=this._players;e.onChange.subscribe(({playing:r,dead:i})=>{!0===i?(this._logger.debug("Removing player that became dead."),t.splice(t.indexOf(e),1),this._update()):!0===r?(this._logger.debug("Updating because player started playing."),t.splice(t.indexOf(e),1),t.unshift(e),this._update()):!1===r&&(this._logger.debug("Updating because player became paused."),this._update())}),e.isPlaying()?t.unshift(e):t.push(e),this._update()}_update(){if(this._updateTimer&&(window.clearTimeout(this._updateTimer),this._updateTimer=null),0===this._players.length){this._logger.debug("There are no longer any players to manage.");return}let{playingPlayers:e,pausedPlayers:t}=this._players.reduce((e,t)=>(t.isPlaying()?e.playingPlayers.push(t):e.pausedPlayers.push(t),e),{playingPlayers:[],pausedPlayers:[]}),r=e.reduce((e,t)=>e+(t.getMemoryCacheUsage()||0),0),i=t.reduce((e,t)=>e+(t.getMemoryCacheUsage()||0),0);if(r>this._maxCacheSize){this._logger.debug("All playing players are using more than the max cache size. Cleaning...",r,this._maxCacheSize);let i=this._maxCacheSize/e.length;e.forEach(e=>I(e,i)),t.forEach(e=>I(e,0))}else this._logger.debug("Recalculating cache sizes...",r+i,this._maxCacheSize),e.concat(t).reduce((e,t)=>(I(t,Math.max(0,this._maxCacheSize-e)),e+(t.getMemoryCacheUsage()||0)),0);this._updateTimer=window.setTimeout(()=>this._update(),2e4)}}let F=Error("No more attempts to retrieve URL.");class N extends E.errors.PlayerFatalError{constructor(e){super(e||"There was no format available that a player was able to play.")}getCode(){return"SCAUDIO.NOT_SUPPORTED_ERROR"}}class q extends N{constructor(){super("There were no stream URLs.")}getCode(){return"SCAUDIO.NO_STREAMS"}}function B(e,t){return void 0!==e?e:t}class V{constructor(e){this._player=e,this._onConnectionRequired=new E.eventDispatcher.EventDispatcher,this._onConnectionRecovered=new E.eventDispatcher.EventDispatcher,this._connectionRequired=!1,this._connectionLossTimer=null,this.onConnectionRequired=this._onConnectionRequired.getHandle(),this.onConnectionRecovered=this._onConnectionRecovered.getHandle();let t=()=>this._calculateIfConnectionRequired();window.addEventListener("online",t),window.addEventListener("offline",t),this._calculateIfConnectionRequired(),e.onChange.subscribe(({loading:r,dead:i})=>{i&&null!==this._connectionLossTimer&&(window.clearTimeout(this._connectionLossTimer),window.removeEventListener("online",t),window.removeEventListener("offline",t)),e.isDead()||void 0===r||this._calculateIfConnectionRequired()})}isConnectionRequired(){return this._connectionRequired}_calculateIfConnectionRequired(){this._player.isLoading()&&"navigator"in window&&!window.navigator.onLine?null===this._connectionLossTimer&&(this._connectionLossTimer=window.setTimeout(()=>{this._connectionLossTimer=null,this._connectionRequired=!0,this._onConnectionRequired.dispatch(void 0)},1500)):this._connectionRequired?(this._connectionRequired=!1,this._onConnectionRecovered.dispatch(void 0)):null!==this._connectionLossTimer&&(window.clearTimeout(this._connectionLossTimer),this._connectionLossTimer=null)}}class H extends N{constructor(){super("Failed to retrieve stream url.")}getCode(){return"SCAUDIO.FAILED_RETRIEVING_URL"}}let z=E.eventDispatcher.EventDispatcher,G=E.helpers.Promise,W=E.helpers.deferred.buildDeferred,K=new j(15e7,E.logger.noOpLogger),Q=-1,J=[],$=1,Y=!1;function X(e,t,r){return Math.min(t,Math.max(e,r))}function Z(e){if("number"!=typeof e)throw Error("level must be a number.");if(e<0||e>1)throw Error("Invalid volume level.");$=e,J.forEach(t=>t.setVolume(e))}function ee(){return $}function et(e){if("boolean"!=typeof e)throw Error("muteEnabled must be a boolean.");Y=e,J.forEach(t=>t.setMuted(e))}function er(){return Y}function ei(e){if("number"!=typeof e||e<0)throw Error("Invalid size.");K.setCacheSize(e)}class eo extends E.ProxyPlayerBase{constructor(e){super(e),this._onPreloadingEnabled=new z,this._onPreloadingDisabled=new z,this._retryDelayCalculator=new b,this._errorEventGenerator=null,this._fadeOutVolumeAutomator=null,this._volumeAutomators=[],this._volumeScale=1,this._userVolume=1,this._volumeAutomationSupported=!1,this._timer=null,this._pauseFadeTimer=null,this._pauseFadeDeferred=null,this._pauseFade=null,this._executionState={state:"IDLE"},this._preloadingListeners=[],this._retrieveAndBuildTimer=null,this._hadAStreamUrl=!1;let t=this._config=function(e){if(!(e.streamUrlRetriever instanceof p))throw Error("StreamUrlRetriever invalid.");if(void 0!==e.duration&&("number"!=typeof e.duration||e.duration<0))throw Error("duration invalid.");if(void 0!==e.getURLOpts&&"object"!=typeof e.getURLOpts)throw Error("getURLOpts invalid.");if(void 0!==e.preloadingEnabled&&"boolean"!=typeof e.preloadingEnabled)throw Error("preloadingEnabled invalid.");if(void 0!==e.fadeOnPauseAndPlay&&"boolean"!=typeof e.fadeOnPauseAndPlay)throw Error("fadeOnPauseAndPlay invalid.");if(void 0!==e.fadeOnSeek&&"boolean"!=typeof e.fadeOnSeek)throw Error("fadeOnSeek invalid.");if(void 0!==e.mediaSessionEnabled&&"boolean"!=typeof e.mediaSessionEnabled)throw Error("mediaSessionEnabled invalid.");if(void 0!==e.pausedMaxBufferLength&&("number"!=typeof e.pausedMaxBufferLength||e.pausedMaxBufferLength<0))throw Error("pausedMaxBufferLength invalid.");if(void 0!==e.playingMaxBufferLength&&("number"!=typeof e.playingMaxBufferLength||e.playingMaxBufferLength<0))throw Error("playingMaxBufferLength invalid.");if(void 0!==e.logger&&"function"!=typeof e.logger&&"object"!=typeof e.logger)throw Error("logger invalid.");if(void 0!==e.audioReporter&&"function"!=typeof e.audioReporter)throw Error("audioReporter invalid.");if(void 0!==e.audioCheckpointInterval&&("number"!=typeof e.audioCheckpointInterval||e.audioCheckpointInterval<0))throw Error("audioCheckpointInterval invalid.");if(void 0!==e.audioPerformanceReporter&&"function"!=typeof e.audioPerformanceReporter)throw Error("audioPerformanceReporter invalid.");if(void 0!==e.errorReporter&&"function"!=typeof e.errorReporter)throw Error("errorReporter invalid.");if(void 0!==e.urlProviderRetryDelayCalculator&&"function"!=typeof e.urlProviderRetryDelayCalculator)throw Error("urlProviderRetryDelayCalculator invalid.");return{controllers:e.controllers,streamUrlRetriever:e.streamUrlRetriever,getURLOpts:B(e.getURLOpts,{}),preloadingEnabled:B(e.preloadingEnabled,!1),pausedMaxBufferLength:B(e.pausedMaxBufferLength,2e3),playingMaxBufferLength:B(e.playingMaxBufferLength,9e4),fadeOnPauseAndPlay:B(e.fadeOnPauseAndPlay,!1),fadeOnSeek:B(e.fadeOnSeek,!1),audioCheckpointInterval:B(e.audioCheckpointInterval,3e4),urlProviderRetryDelayCalculator:B(e.urlProviderRetryDelayCalculator,E.helpers.retry.buildExponentialDelayCalculator()),streamUrlsExpire:B(e.streamUrlsExpire,!0),fetchEnabled:B(e.fetchEnabled,!0),duration:e.duration,audioReporter:e.audioReporter,audioPerformanceReporter:e.audioPerformanceReporter,errorReporter:e.errorReporter,seekStrategy:e.seekStrategy,useIphoneHlsHack:B(e.useIphoneHlsHack,!1),fairPlayManager:e.fairPlayManager,applicationId:e.applicationId}}(e);this._preloadingEnabled=t.preloadingEnabled,this._getURLOpts=t.getURLOpts,this._controllers=t.controllers;let r=this._connectionRequiredHelper=new V(this);this.onPreloadingEnabled=this._onPreloadingEnabled.getHandle(),this.onPreloadingDisabled=this._onPreloadingDisabled.getHandle(),this.onConnectionRequired=r.onConnectionRequired,this.onConnectionRecovered=r.onConnectionRecovered,this.onChange.subscribe(e=>{this.isDead()||((!1===e.playing||e.positionJumped||e.stalled||e.ended)&&this._completePauseFade(),this._pauseFade&&(!1===e.actuallyPlaying||e.ended||!0===e.playing)&&(this._removeVolumeAutomator(this._pauseFade),this._pauseFade=null),(e.positionJumped||void 0!==e.actuallyPlaying||void 0!==e.stalled)&&this._updateVolume(),void 0!==e.playing&&this._updateMaxBufferLength())});let i=`SCAudio-${++Q}`,o=t.streamUrlRetriever.getTrackId();null!==o&&(i+=`-${o}`);let n=new w,a=E.logger.cloneLogger(n,this._logger);this._logger=E.logger.prefixLogger(a,i);let s=function(){let e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",t="";for(let r=0;r<20;r++)t+=e.charAt(Math.floor(Math.random()*e.length));return t}();this._logger.info("Building player...",{ua:navigator.userAgent,getURLOpts:this._getURLOpts,logId:s}),J.push(this),this.setVolume($,Y),this._updateFadeOut();let l=null,u=null;t.audioPerformanceReporter&&(l=new T(this,()=>this._getPlayer(),t.audioPerformanceReporter,this._logger,()=>this._getActivePlayerDetails())),t.audioReporter&&new A(this,t.audioReporter,t.audioCheckpointInterval,this._logger,()=>this._getActivePlayerDetails()),t.errorReporter&&(u=this._errorEventGenerator=new L(this,n,s,o,t.errorReporter,this._logger)),this._excludeUnsupportedRenditions();let h=this._controllerManager=new D({logger:this._logger,seekStrategy:this._config.seekStrategy,controllers:t.controllers,playerId:i,streamUrlsExpire:t.streamUrlsExpire,fetchEnabled:t.fetchEnabled,fadeOnPauseAndPlay:t.fadeOnPauseAndPlay,fadeOnSeek:t.fadeOnSeek,cacheManager:K,providePlayer:(e,t,r)=>{this._volumeAutomationSupported=r,this._providePlayer(e,t),this._updateMaxBufferLength()},removePlayer:()=>{this._getPlayer()&&this._removePlayer()},streamUrlRetriever:this._config.streamUrlRetriever,getURLOpts:this._getURLOpts,errorEventGenerator:u||void 0,audioPerformanceEventGenerator:l||void 0,useIphoneHlsHack:t.useIphoneHlsHack||!1,fairPlayManager:t.fairPlayManager,applicationId:t.applicationId});if(this.onQualityChanged=h.onQualityChanged,void 0!==t.duration&&(this._logger.debug("Setting initial duration.",t.duration),this._setInitialDuration(t.duration)),this._preloadingEnabled)this._logger.debug("Preloading is enabled, so performing retrieve immediately."),this._retrieveAndBuild();else{this._logger.debug("Preloading is disabled, so deferring retrieve until either a play intent or preloading is enabled.");let e=()=>{this._removePreloadingListeners(),this._logger.debug("Preloading now enabled or received a play request. Peforming retrieve."),this._retrieveAndBuild()};this._preloadingListeners.push(this.onPreloadingEnabled.subscribe(e),this.onPlayIntent.subscribe(e))}}reload(e={}){this._ensureNotDead(),this._reloadStreamUrls(e)}enablePreloading(){!this.isDead()&&(this._preloadingEnabled||(this._preloadingEnabled=!0,this._updateMaxBufferLength(),this._onPreloadingEnabled.dispatch(void 0)))}disablePreloading(){!this.isDead()&&this._preloadingEnabled&&(this._preloadingEnabled=!1,this._updateMaxBufferLength(),this._onPreloadingDisabled.dispatch(void 0))}isPreloadingEnabled(){return this._preloadingEnabled}pauseAfterFade(e){if(this._ensureNotDead(),this._pauseFadeDeferred)return this._pauseFadeDeferred.promise;if(!this.isPlaying()||!this.isActuallyPlaying())return G.resolve(this.pause());let t=W();this._pauseFadeDeferred=t;let r=this.getPosition();if(this._pauseFade)throw Error("Fade should not already be assigned.");return this._pauseFade=new _({startPos:r,endPos:r+e,startLevel:1,endLevel:0}),this._addVolumeAutomator(this._pauseFade),this._pauseFadeTimer=window.setTimeout(()=>{this._pauseFadeDeferred=null,t.resolve(this.pause({fadeDuration:0}))},e+50),t.promise}isConnectionRequired(){return this._connectionRequiredHelper.isConnectionRequired()}getQuality(){return this._controllerManager.getQuality()}getVolume(){return this._volumeAutomationSupported?this._userVolume:super.getVolume()}_handleFatalError(e){this._logger.warn("Fatal error from current player.",e)}_handleVolumeChange(e,t){this._userVolume=e,super._notifyVolumeChange(e,t),this._calculateAndSetVolume()}_notifyVolumeChange(){}_kill(){super._kill(),this._timer&&window.clearTimeout(this._timer),this._abortPauseFade(),this._removePreloadingListeners(),J.splice(J.indexOf(this),1),"RETRIEVING_URL"===this._executionState.state?this._executionState.retrieveJob.abort():"CONTROLLING_PLAYER"===this._executionState.state&&this._controllerManager.releaseCurrentController({retry:!1}),this._executionState={state:"DEAD"},this._retrieveAndBuildTimer&&window.clearTimeout(this._retrieveAndBuildTimer)}_excludeUnsupportedRenditions(){let e={streamUrlExpires:this._config.streamUrlsExpire};m.filter(t=>!this._controllers.some(r=>r.isRenditionSupported(t,e,{useIphoneHlsHack:this._config.useIphoneHlsHack||!1,fairPlayManager:this._config.fairPlayManager}))).forEach(e=>{this._config.streamUrlRetriever.excludeRendition(e)})}_addVolumeAutomator(e){0>this._volumeAutomators.indexOf(e)&&(this._volumeAutomators.push(e),this._updateVolume())}_removeVolumeAutomator(e){let t=this._volumeAutomators.indexOf(e);t>=0&&(this._volumeAutomators.splice(t,1),this._updateVolume())}_removePreloadingListeners(){this._preloadingListeners.forEach(e=>e.remove())}_getActivePlayerDetails(){return"CONTROLLING_PLAYER"!==this._executionState.state?null:this._controllerManager.getPlayerDetails()}_updateFadeOut(){this._fadeOutVolumeAutomator&&this._removeVolumeAutomator(this._fadeOutVolumeAutomator),this._getURLOpts.snippet&&(this._fadeOutVolumeAutomator=d(3e3),this._addVolumeAutomator(this._fadeOutVolumeAutomator))}_handleUnexpectedError(e){try{e()}catch(e){this._logger.error("Unexpected error.",e),this._triggerError(new E.errors.PlayerFatalError("An unexpected error occurred.",e))}}_retrieveAndBuild(){this._handleUnexpectedError(()=>{if(-1===["IDLE","WAITING_TO_RETRIEVE"].indexOf(this._executionState.state))throw Error("Invalid state for retrieveAndBuild().");this._logger.debug("Retrieving URL...");let e=function({streamUrlRetriever:e,getURLOpts:t,logger:r,urlProviderRetryDelayCalculator:i}){return new E.helpers.abortableJob.AbortableJob(()=>{let o=E.helpers.deferred.buildDeferred(),{cancel:n}=E.helpers.retry.retry(i,({scheduleRetry:i})=>{let n=e.getUrl(t);return r.debug("Retrieving a URL..."),n.onCompletion(t=>{t?t.rendition&&0>m.indexOf(t.rendition)?(r.warn("Unknown rendition. Skipping...",t.rendition),e.excludeRendition(t.rendition),i()):!t.success&&!1===t.success&&t.error.isTransient()?(r.warn("Transient error retrieving url.",t.error),i()):o.resolve(t):(r.debug("No URL provided."),o.resolve(null))}),n.onError(e=>{e!==E.helpers.abortableJob.abortedError&&r.error("Error retrieving URL.",e),o.reject(e)}),{onCancel:()=>n.abort()}},{onNoMoreRetries:()=>o.reject(F)});return{result:o.promise,abort:()=>n()}}).run()}({streamUrlRetriever:this._config.streamUrlRetriever,urlProviderRetryDelayCalculator:this._config.urlProviderRetryDelayCalculator,getURLOpts:this._getURLOpts,logger:this._logger});this._executionState={state:"RETRIEVING_URL",retrieveJob:e},e.onCompletion(e=>{if(this._logger.debug("Retrieved URL.",!!e),e&&e.success){this._hadAStreamUrl=!0;let t=!1,r=({excludeRendition:r,immediateRetry:i})=>{this._handleUnexpectedError(()=>{if(t)throw Error("startOver called multiple times.");if(t=!0,r&&this._config.streamUrlRetriever.excludeRendition(e.rendition),this._executionState={state:"WAITING_TO_RETRIEVE"},this.isDead()){this._logger.debug("Stopping execution because player is dead.");return}if(i)this._logger.debug("Moving on immediately."),this._retrieveAndBuild();else{let e=this._retryDelayCalculator.getDelay();this._logger.debug(`Will move on in ${e}ms.`),e?this._retrieveAndBuildTimer=window.setTimeout(()=>this._retrieveAndBuild(),e):this._retrieveAndBuild()}})};this._handleUnexpectedError(()=>{this._executionState={state:"CONTROLLING_PLAYER"},this._logger.debug("Building controller..."),this._controllerManager.buildNextController(e,r),this._logger.debug("Built controller.")})}else if(e&&e.rendition&&!1===e.success){if(this._logger.warn("Error retrieving URL. Moving on.",e.error),this._errorEventGenerator){let t=`SCAUDIO.URL_RETRIEVER_ERROR.${this._config.streamUrlRetriever.name}.${e.error.getCode()}`;this._errorEventGenerator.reportManualEvent(t,{preset:e.preset,quality:e.quality,bitrate:e.bitrate,format:e.rendition.scFormat,protocol:e.rendition.scProtocol})}this._config.streamUrlRetriever.excludeRendition(e.rendition),this._executionState={state:"WAITING_TO_RETRIEVE"},this._retrieveAndBuild()}else e&&e.rendition&&!1===e.success&&this._logger.warn("Error retrieving URL for any rendition.",e.error),this._logger.info("Ran out of streams.",this._hadAStreamUrl),this._triggerError(this._hadAStreamUrl?new N:new q)}),e.onError(e=>{e!==E.helpers.abortableJob.abortedError&&(e===F?this._logger.error("Ran out of retries to retrieve URL."):this._logger.error("Unexpected error when retrieving a URL.",e),this._triggerError(new H))})})}_reloadStreamUrls(e){this._getURLOpts=e,this._updateFadeOut(),this._logger.info("Reloading stream URL's...",this._getURLOpts),"RETRIEVING_URL"===this._executionState.state?(this._logger.debug("Aborting current URL retrieve."),this._executionState.retrieveJob.abort(),this._executionState={state:"WAITING_TO_RETRIEVE"},this._retrieveAndBuild()):"CONTROLLING_PLAYER"===this._executionState.state?(this._logger.debug("Releasing controller."),this._controllerManager.releaseCurrentController({retry:!0})):this._logger.debug("Nothing to do."),this._logger.info("Reloaded stream URL's.")}_completePauseFade(){if(this._pauseFadeDeferred){this._pauseFadeTimer&&window.clearTimeout(this._pauseFadeTimer);let e=this._pauseFadeDeferred;this._pauseFadeDeferred=null,e.resolve(this.pause())}}_abortPauseFade(){this._pauseFadeTimer&&(window.clearTimeout(this._pauseFadeTimer),this._pauseFadeTimer=null),this._pauseFadeDeferred&&(this._pauseFadeDeferred.reject(Error("Player was killed.")),this._pauseFadeDeferred=null)}_updateVolume(){if(!this._volumeAutomationSupported)return;this._ensureNotDead(),this._timer&&(window.clearTimeout(this._timer),this._timer=null);let e=this.getDuration();if(null===e)return;let t=this._volumeAutomators,r=this.getPosition(),i=1/0,o=1;t.forEach(t=>{let{nextCalculatePosition:n,level:a}=t.calculate(r,e);o*=X(0,1,a),n<i&&(i=n)}),this._volumeScale!==o&&(this._volumeScale=o,this._calculateAndSetVolume()),i<1/0&&this.isActuallyPlaying()&&!this.isStalled()&&(this._timer=window.setTimeout(()=>{this._timer=null,this._updateVolume()},X(100,5e3,i-this.getPosition())))}_calculateAndSetVolume(){this._volumeAutomationSupported?super._handleVolumeChange(this._userVolume*this._volumeScale,this.getMuted()):super._handleVolumeChange(this._userVolume,this.getMuted())}_updateMaxBufferLength(){let e=this._getPlayer(),t=e&&e.getBufferController();t&&(this.isPlaying()?t.setMaxBufferLength(this._config.playingMaxBufferLength):t.setMaxBufferLength(this._preloadingEnabled?this._config.pausedMaxBufferLength:0))}}var en=h(64);let ea=E.logger.prefixLogger;class es{constructor(e,t){this._cleanupCallbacks=[],this._licenseUrl=e+"/playback/fairplay",this._logger=ea(t,"LegacyFairPlayManager")}static isSupported(){return!!window.WebKitMediaKeys}registerPlayer(e){this._unregister();let t=e.onChange.subscribe(({playing:t})=>{var r;let i=e.getMediaElement();t&&i&&i!==this._attachedMediaElement&&(this._attachedMediaElement=i,this._applicationCertificate?this._registerMediaElement(i):(this._applicationCertificatePromise||this._requestApplicationCertificate(),null===(r=this._applicationCertificatePromise)||void 0===r||r.then(()=>this._registerMediaElement(i))))});this._cleanupCallbacks.push(()=>t.remove())}_unregister(){for(let e=0;e<this._cleanupCallbacks.length;++e){let t=this._cleanupCallbacks[e];try{t()}catch(e){this._logger.warn("Error calling cleanup function to unregister player.",e)}}this._attachedMediaElement=void 0,this._cleanupCallbacks=[]}_requestApplicationCertificate(){this._logger.debug("Requesting fairplay application certificate");let e=this._licenseUrl,t=en.arrayBufferLoader.request({url:e});this._applicationCertificatePromise=t.getResponse().then(e=>{if(!e)throw Error("No response requesting application certificate");if(200!==e.statusCode)throw Error(`Received status ${e.statusCode} requesting application certificate`);let t=e.getData();this._applicationCertificate=new Uint8Array(t),this._applicationCertificatePromise=void 0,this._logger.debug("Application certificate received")}).catch(e=>{this._logger.error("Error requesting application certificate.",e)})}_onWebKitNeedKey(e,t,r){let i=function(e){let t=String.fromCharCode.apply(null,new Uint16Array(e.buffer)),r=t.indexOf("skd://")+6;return t.substring(r)}(r.initData),o=function(e,t,r){let i=function(e){let t=new Uint16Array(new ArrayBuffer(2*e.length));for(let r=0;r<e.length;r++)t[r]=e.charCodeAt(r);return t}(t),o=0,n=new ArrayBuffer(e.byteLength+4+i.byteLength+4+r.byteLength),a=new DataView(n);new Uint8Array(n,o,e.byteLength).set(e),o+=e.byteLength,a.setUint32(o,i.byteLength,!0);let s=new Uint16Array(n,o+=4,i.length);return s.set(i),o+=s.byteLength,a.setUint32(o,r.byteLength,!0),new Uint8Array(n,o+=4,r.byteLength).set(r),new Uint8Array(n,0,n.byteLength)}(r.initData,i,t),n=new window.WebKitMediaKeys("com.apple.fps.1_0");e.webkitSetMediaKeys(n);let a=n.createSession("application/vnd.apple.mpegurl",o),s=e=>{var t;this._logger.debug("webkitkeymessage event received");let r=(t=new Uint8Array(e.message),btoa(String.fromCodePoint.apply(null,t)));this._requestLicense(this._licenseUrl,r,i).then(e=>{a.update(e)}).catch(e=>{this._logger.error("Error requesting fairplay license",e)})};a.addEventListener("webkitkeymessage",s),this._cleanupCallbacks.push(()=>a.removeEventListener("webkitkeymessage",s)),this._cleanupCallbacks.push(()=>a.close())}_requestLicense(e,t,r){return this._logger.debug("Requesting license"),fetch(e,{headers:{"Content-Type":"application/x-www-form-urlencoded"},body:`spc=${t}&assetId=${r}`,method:"POST"}).then(e=>{if(!e)throw Error("No response requesting fairplay license");if(200!==e.status)throw Error(`Received status ${e.status} requesting fairplay license`);return this._logger.debug("License received"),e.arrayBuffer()}).then(e=>(function(e){let t=new Uint8Array(e.length);for(let r=0;r<e.length;r++)t[r]=e.charCodeAt(r);return t})(atob(new TextDecoder().decode(e).trim())))}_registerMediaElement(e){let t=t=>{this._logger.debug("webkitneedkey event received"),this._applicationCertificate&&this._onWebKitNeedKey(e,this._applicationCertificate,t)};e.addEventListener("webkitneedkey",t),this._cleanupCallbacks.push(()=>e.removeEventListener("webkitneedkey",t))}}function el(e){switch(e){case a.SQ:return a.SQ;case a.HQ:return a.HQ}return null}(i=a||(a={})).SQ="sq",i.HQ="hq",(o=s||(s={})).NotSupportedError=N,o.NoStreamsError=q,o.FailedRetrievingUrlError=H;let eu="24.1.3",eh=1201;return c})(),e.exports=i(r(18471),r(92784))}}]);