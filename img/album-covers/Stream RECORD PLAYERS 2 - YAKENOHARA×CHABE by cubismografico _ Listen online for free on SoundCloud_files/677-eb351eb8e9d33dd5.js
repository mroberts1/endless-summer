(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[677],{37966:function(e,t,i){var r;"undefined"!=typeof self&&self,r=e=>(()=>{"use strict";var t,i,r,n,a,s,l=[,t=>{t.exports=e}],d={};function o(e){var t=d[e];if(void 0!==t)return t.exports;var i=d[e]={exports:{}};return l[e](i,i.exports,o),i.exports}o.d=(e,t)=>{for(var i in t)o.o(t,i)&&!o.o(e,i)&&Object.defineProperty(e,i,{enumerable:!0,get:t[i]})},o.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),o.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})};var h={};o.r(h),o.d(h,{HTML5Player:()=>Q,HTML5PlayerBase:()=>G,WebAudioContext:()=>C,buildNumber:()=>$,errors:()=>a,helpers:()=>s,version:()=>Z});var u=o(1);function m(e){let t=[],i=e.length;for(let r=0;r<i;r++)t.push({end:1e3*e.end(r),start:1e3*e.start(r)});return u.TimeRange.normalizeRawTimeRanges(t).map(e=>new u.TimeRange(e.start,e.end-e.start))}(t=n||(n={}))[t.UP=0]="UP",t[t.DOWN=1]="DOWN";class _{constructor(e,t){this._context=e,this._gain=t,this._currentFade={startTime:0,startValue:1,rate:0},this._fadeEndTimer=null}isFading(){return!!this._fadeEndTimer}getDirection(){let{rate:e,startValue:t}=this._currentFade;return 0===e?0===t?n.DOWN:n.UP:e<0?n.DOWN:n.UP}performFade(e,t){if(0===e)throw Error("Rate cannot be 0.");this._fadeEndTimer&&window.clearTimeout(this._fadeEndTimer);let i=this._context.currentTime,r=this._gain;if(e===1/0||e===-1/0){r.gain.cancelScheduledValues(i);let n=e===1/0?1:0;r.gain.setValueAtTime(n,i),this._currentFade={startTime:i,startValue:n,rate:0},this._fadeEndTimer=null,t&&t()}else{let n=this._currentFade,a=Math.min(1,Math.max(0,n.startValue+1e3*n.rate*(i-n.startTime))),s=e>0?1-a:a,l=1/Math.abs(1e3*e)*s,d=i+l;this._currentFade={startTime:i,rate:e,startValue:a},r.gain.cancelScheduledValues(i),r.gain.setValueAtTime(a,i),r.gain.linearRampToValueAtTime(e>0?1:0,d),this._fadeEndTimer=window.setTimeout(()=>{this._fadeEndTimer=null,t&&t()},1e3*l)}}}class g extends u.errors.PlayerFatalError{constructor(){super("An unrecoverable network error occurred.")}getCode(){return"HTML5_PLAYER.NETWORK_ERROR"}}class c extends u.errors.PlayerFatalError{constructor(){super("An unrecoverable error occurred whilst decoding.")}getCode(){return"HTML5_PLAYER.DECODE_ERROR"}}class p extends u.errors.PlayerFatalError{constructor(e){super("Unexpected error from media element.",e),this._error=e}getCode(){return`HTML5_PLAYER.UNEXPECTED_MEDIA_ELEMENT_ERROR_${this._error&&this._error.code||"UNKNWON"}`}}class E extends u.errors.PlayerFatalError{constructor(e){super("An error occurred when initializing the media element.",e)}getCode(){return"HTML5_PLAYER.INITIALIZE_ERROR"}}class y extends u.errors.PlayerFatalError{constructor(e="An error occurred when activating web audio.",t){super(e,t)}getCode(){return"HTML5_PLAYER.WEB_AUDIO_ACTIVATION_ERROR"}}class f extends y{constructor(e){super("We timed out when trying to activate web audio.",e)}getCode(){return"HTML5_PLAYER.WEB_AUDIO_ACTIVATION_TIMEOUT_ERROR"}}class A extends u.errors.PlayerError{constructor(e="An error occurred when initializing web audio.",t){super(e,t)}getCode(){return"HTML5_PLAYER.WEB_AUDIO_INITIALIZE_ERROR"}}class S extends A{constructor(e){super("Web audio found no channels.",e)}getCode(){return"HTML5_PLAYER.WEB_AUDIO_INITIALIZE_NO_CHANNELS_ERROR"}}class v{constructor(e,t=2e4){this._audioContext=e,this._idleTime=t,this._players=[],this._prevPlayingCount=0,this._playingCount=0,this._timerId=null,this._suspendTimerId=null,this._suspendSupported="function"==typeof e.suspend}watchPlayer(e){!(!this._suspendSupported||e.isDead()||this._players.indexOf(e)>=0)&&(e.onChange.subscribe(({dead:t,playing:i})=>{if(void 0!==i&&this._handleCountChange(i),t){let t=this._players.indexOf(e);t>=0&&(this._players.splice(t,1),!this._players.length&&this._suspendTimerId&&(window.clearInterval(this._suspendTimerId),this._suspendTimerId=null))}}),this._players.length||(this._suspendTimerId=window.setInterval(()=>{0===this._playingCount&&null===this._timerId&&"suspended"!==this._audioContext.state&&this._scheduleSuspend(5e3)},5e3)),this._players.push(e),e.isPlaying()&&this._handleCountChange(!0))}_handleCountChange(e){e?this._playingCount++:this._playingCount--,this._playingCount!==this._prevPlayingCount&&(this._prevPlayingCount=this._playingCount,0===this._playingCount?this._scheduleSuspend(this._idleTime):1===this._playingCount&&this._abortSuspend())}_scheduleSuspend(e){this._timerId=window.setTimeout(()=>{this._timerId=null,this._audioContext.suspend()},e)}_abortSuspend(){this._timerId&&(window.clearTimeout(this._timerId),this._timerId=null)}}let b=u.helpers.browser.getFirefoxVersion(),P=Error("Web audio activation timed out."),T=Error("Web audio found no output channels."),w=null;function k(){return"AudioContext"in window&&(u.helpers.browser.isChrome()||b&&b.major>=48||u.helpers.browser.isEdge())}function M(){if(w)return w;if(!k())throw Error("Web audio is not enabled.");let e=new window.AudioContext;if(!e.destination.maxChannelCount)throw T;return w={context:e,suspender:new v(e)}}class C{getAudioContextWithSuspender(){return k()?M():null}activate(){if(!k())return u.helpers.Promise.resolve(void 0);try{let{context:e}=M();return e.state&&e.resume&&"running"!==e.state?u.helpers.promiseWithTimeout(e.resume(),5e3,P):u.helpers.Promise.resolve()}catch(e){return u.helpers.Promise.reject(e)}}}function x(e,t={}){let i=e.mimeType||t.mimeType;if(!i)return null;let r=e.audioCodec||t.audioCodec,n=e.videoCodec||t.videoCodec,a=u.helpers.compact([r,n]);return i+(a.length>0?`; codecs="${a.map(e=>e.id).join(",")}"`:"")}let R=u.helpers.deferred.buildDeferred,F=u.helpers.url.getExtension,I=u.helpers.time.now,{Promise:D,browser:O}=u.helpers,L=u.logger.prefixLogger,{NotSupportedError:W,PlayerFatalError:N}=u.errors,U=Error("Media element was revoked."),B=[],H=new u.helpers.SCWeakMap,z=null,V=u.helpers.retry.buildExponentialDelayCalculator({jitter:0,timeBase:50});function j(e){try{return!!document.createElement("audio").canPlayType(e)}catch(e){return!1}}class G extends u.BasePlayer{constructor(e){super(e),this._duration=null,this._stallDetected=!1,this._fadeManagers=null,this._shouldCoverGlitch=!0,this._initialized=!1,this._muted=!1,this._volume=1,this._deferredProvideMediaElementCallback=null,this._playInProgress={inProgress:!1},this._lastStallCheckPos=null,this._stallCheckTimerId=null,this._timeWhenPositionChanged=0,this._endedOverride=!1,this._pauseEventTimer=null,this._positionWhenMediaElementRevoked=0,this._playingWhenMediaElementRevoked=!1,this._provideMediaElementDeferred=null,this._mediaElementAndState=null,this._listeners=[],this._currentSeek=null,this._playDetectionPosition=0,this._playDetectionTimer=null,this._playDetectionTimerNumAttempts=0,this._fadeRate=null,this._seekFadeRate=null,this._lastSeek=null,this._webAudioOrchestration=null,this._fadeEndedHandle=null,this._onSeekFadeOutCompleted=null,this._fadeRateAfterSeek=1/0,this._mediaElPlayShouldBeAborted=new u.helpers.SCWeakMap,this._mediaElPaused=new u.helpers.SCWeakMap,this._mediaElPlayTracker=null,this._logger=L(this._logger,"HTML5PlayerBase"),this._playerDependencies=e,this._webAudioContext=e.webAudioContext||z||(z=new C),this._addCachedCurrentTimeListeners();let t=this._webAudioOrchestration=e.fadeSupportEnabled?this._initWebAudio():null;t&&(this._logger.debug("Fading supported."),this._fadeManagers={pausePlay:new _(t.context,t.gainNodes.pausePlay),seek:new _(t.context,t.gainNodes.seek)}),this._handleDurationUpdates();let i=void 0!==e.mediaElement?e.mediaElement:this._createDefaultMediaElement();i&&this.provideMediaElement(i).catch(e=>{if(e===U){this._logger.debug("Initial provideMediaElement() call was aborted.");return}this._triggerError(new E(e))});let r=this._fadeManagers;r&&this.onChange.subscribe(({stalled:e,seek:t,ended:i})=>{if(i&&r.seek.getDirection()===n.UP&&r.seek.isFading())this._logger.debug("Completing fade in after seek early because reached end."),r.seek.performFade(1/0),this._notifyFadingForSeek(!1);else{let i=this.getSeekState(),a=i&&"COMPLETED"===i.state,s=t&&"COMPLETED"===t.state;(!1===e&&a||s&&!this.isStalled())&&r.seek.getDirection()===n.DOWN&&(this._logger.debug("Fading in after seek.",this._fadeRateAfterSeek),r.seek.performFade(this._fadeRateAfterSeek,()=>this._notifyFadingForSeek(!1)))}}),this._logger.info("Checking if the player can play the provided descriptor."),this._canPlayTimer=window.setTimeout(()=>{this._canPlay().then(e=>{if(!this.isDead()){if(e instanceof u.errors.NotSupportedError){this._logger.info("Player not supported.",e),this._triggerError(e);return}if(e)this._logger.info("Player supported."),this._initialize();else{this._logger.info("Player not supported."),this._triggerError(new W);return}}}).catch(e=>{this._logger.error("Unexpected error during can play check.",e),this._triggerError(new N("An unexpected error occured during initialization.",e))})},0)}static isFormatSupported(e){let t=x(e);return!!t&&j(t)}getMediaElement(){return this._mediaElementAndState&&this._mediaElementAndState.element}provideMediaElement(e){if(this._ensureNotDead(),this._mediaElementAndState)throw Error("Already have a media element.");if(B.indexOf(e)>=0)throw Error("The same media element is currently being used in another player.");if(!this._webAudioOrchestration&&H.has(e))throw Error("The same media element has been used in another player with fading enabled.");B.push(e);let t=this._provideMediaElementDeferred=R();return this._update(()=>{this._logger.debug("provideMediaElement() called.",e),this._initMediaElementLocal(e,!1);let i=this._mediaElementAndState={element:e,state:"INITIALIZING"},r=()=>{this._logger.debug("Initializing media element."),this._initMediaElement(e,!0),this._addPausedHandlers(e),this._attachListeners();let r=this._listenToOnce("error",()=>{this._provideMediaElementDeferred=null;let i=e.error,r=i?i.code:"unknown";this._logger.error("Error whilst initializing media element.",r),this.revokeMediaElement(),t.reject(Error("Error when initializing media element. Error: "+r))},{earlyAttach:!0}),n=()=>{this._logger.debug("Putting media element in the state that is expected..."),a()},a=()=>{null===this._getQueuedSeekPosition()&&this._positionWhenMediaElementRevoked>0?(this._logger.debug("Seeking to expected position..."),this._performSeek(this._positionWhenMediaElementRevoked,e=>{if(void 0!==e){this._provideMediaElementDeferred=null,this._logger.error("An error occurred when trying to seek to the expected position."),this.revokeMediaElement(),t.reject(Error("An error occurred when trying to restore the position."));return}this._logger.debug("Seeked to expected position."),s()})):s()},s=()=>{this.isPlaying()===this.isActuallyPlaying()&&this._playingWhenMediaElementRevoked?(this._logger.debug("Calling play to match previous state..."),this._mediaElementPlay().catch(e=>{this._provideMediaElementDeferred=null,this._logger.error("An error occurred when trying to play.",e),i===this._mediaElementAndState&&this.revokeMediaElement(),t.reject(Error("Browser refused play() request on media element."))}),this._listenToOnce("play",()=>{this._logger.debug("Play succeeded."),l()},{earlyAttach:!0})):l()},l=()=>{if(this._mediaElementAndState!==i){this._triggerError(new N("Media element switched unexpectedly."));return}this._provideMediaElementDeferred=null,r.remove(),t.resolve(void 0),this._mediaElementAndState.state="STABLE",this._logger.debug("Finished putting element in expected state."),this._shouldCoverGlitch=!0,null!==this._duration&&this._update(()=>{this.isReady()||this._signalReady(),this._handleDeferredPauseAndSeek()})};this._listenToOnce("emptied",()=>{this._logger.debug("Got emptied event from media element."),n()},{earlyAttach:!0})};this._initialized?r():this._deferredProvideMediaElementCallback=r}),t.promise}revokeMediaElement(){if(!this._mediaElementAndState)throw Error("There is no media element to revoke.");this._deferredProvideMediaElementCallback=null,this._provideMediaElementDeferred&&(this._provideMediaElementDeferred.reject(U),this._provideMediaElementDeferred=null),this._logger.debug("revokeMediaElement() called."),this._detachListeners();let e=this._mediaElementAndState.element,t=B.indexOf(e);t>=0&&B.splice(t,1),this._onSeekFadeOutCompleted=null,this.isDead()||(this._positionWhenMediaElementRevoked=this.getPosition(),this._playingWhenMediaElementRevoked=this.isPlaying()),this._mediaElementAndState=null,this._initMediaElement(e,!1),this._removePausedHandlers(e),this._completeCurrentFade(),this._completeSeekFadeOutAndIn(),this._update(()=>{this.isDead()||(!this.isPlaying()&&this.isActuallyPlaying()&&this._notifyPlaying(!1),this._handleStalled())})}getBufferedTimeRanges(){return this._mediaElementAndState&&"USABLE"===this._mediaElementAndState.state?m(this._mediaElementAndState.element.buffered):[]}getMaxBufferLength(){return null}_hasInitialized(){return this._initialized}_inferFormat(e){switch(F(e)){case"mp3":return{mimeType:"audio/mpeg"};case"opus":return{mimeType:"audio/ogg",audioCodec:{id:"opus"}};case"mp4":return{mimeType:"video/mp4"};case"m4a":return{mimeType:"audio/mp4"};case"m3u8":return{mimeType:"application/x-mpegURL"};default:return{}}}_canPlayType(e){return j(e)}_initialize(){this._initialized=!0,this._listenTo("error",()=>{if("INITIALIZING"===this._mediaElementAndState.state){this._logger.debug("An error occurred, but the media element is initializing, so ignoring...");return}let e=this._mediaElementAndState.element.error;switch(e&&e.code){case 2:this._triggerError(new g);break;case 3:this._triggerError(new c);break;default:this._logger.error("Unexpected error from media element.",e&&e.code,e&&e.message),this._triggerError(new p(e))}},{earlyAttach:!0}),this._listenTo("play",()=>{this._logger.debug("Media element play event."),this._updateCachedCurrentTime(),this.isPlaying()||this.isActuallyPlaying()||!this._mediaElementAndState||this._isMediaElementPaused(this._mediaElementAndState.element)||(this._logger.debug("Calling play() because something external called play() on media element."),this.play())}),this._listenTo("playing",()=>{this._logger.debug("Media element playing event."),this._updateCachedCurrentTime(),this._mediaElementAndState&&!this._isMediaElementPaused(this._mediaElementAndState.element)?this._handlePlayingEvent():this._logger.debug("Ignoring playing event because media element is reporting it is paused.")}),this._listenTo("timeupdate",()=>{this._updateCachedCurrentTime(),this._determineIfPlaying()}),this._listenTo("pause",()=>{this._logger.debug("Media element pause event."),this._updateCachedCurrentTime(),this._mediaElementAndState&&this._isMediaElementPaused(this._mediaElementAndState.element)?this._handlePauseEvent():this._logger.debug("Ignoring pause event because media element is reporting it is not paused.")}),this._listenTo("seeking",()=>{if(null===this._getQueuedSeekPosition()&&(this._logger.debug("Media element seeking event."),this._mediaElementAndState&&"USABLE"===this._mediaElementAndState.state)){let e=1e3*this._mediaElementAndState.element.currentTime,t=this._lastSeek;if(t&&(null===t.unstallTime||t.unstallTime+500>I())&&500>=Math.abs(t.position-e)){this._logger.debug("Ignoring seeking event because we seeked recently to somewhere near.");return}let i=this._mediaElementAndState.cachedMediaElTime.elTime;this._logger.debug(`Reverting seek on media element to ${i}.`),this._mediaElementAndState.element.currentTime=i/1e3,this._updateCachedCurrentTime(),this._lastSeek={unstallTime:I(),position:i},this.seek(e,{fadeOutDuration:0}).catch(t=>{this._logger.warn(`Error when trying to seek to ${e} whilst handling seeking event`,t)})}}),this._listenTo("ended",()=>{this._logger.debug("Media element ended event."),this._mediaElementAndState&&this._mediaElementAndState.element.ended?this._handleEndedEvent():this._logger.debug("Ignoring ended event because media element is reporting it is not ended.")}),this._listenTo("stalled",()=>{this._logger.debug("Media element stalled event."),this._checkIfStalled()}),this._listenTo("volumechange",()=>{this._mediaElementAndState&&this._notifyVolumeChangeFromMediaEl(this._mediaElementAndState.element)}),this._stallCheckTimerId=window.setInterval(()=>this._checkIfStalled(),400),this._deferredProvideMediaElementCallback&&this._deferredProvideMediaElementCallback()}_handleDurationChange(){let e=this._duration;null!==e&&this._update(()=>{this._provideDuration(e),this._mediaElementAndState&&"STABLE"===this._mediaElementAndState.state&&(this.isReady()||this._signalReady(),this._handleDeferredPauseAndSeek())})}_createDefaultMediaElement(){return document.createElement(this._playerDependencies.mediaElementType||"audio")}_handlePauseEvent(){if(!this._mediaElementAndState)throw Error("Media element should exist.");let e=this._mediaElementAndState.element;this.isActuallyPlaying()&&this._update(()=>{e.ended||(this._notifyNotStalled(),this._completeCurrentFade(),this._completeSeekFadeOutAndIn(),this._notifyPlaying(!1))})}_handlePlayingEvent(){let e=this._duration;if(null===e)throw Error("Expecting duration to exist.");let t=this._getTruePosition();if(t>=e){this._logger.warn("Got a media element playing event and the positon was >= the duration.",t,e);return}if(this.isEnded()||this._shouldBeEnded()){this._logger.warn("Got a media element playing event when the player is/should be ended.");return}this._update(()=>{this._notifyNotStalled(),this._determineIfPlaying(),this.isActuallyPlaying()||(this._playDetectionTimerNumAttempts=0,this._playDetectionTimer||(this._playDetectionTimer=window.setInterval(()=>this._determineIfPlaying(),10)))})}_handleEndedEvent(){if(null!==this._getQueuedSeekPosition()){this._logger.warn("Got a media element ended event but ignoring because a seek is in progress.");return}this._update()}_shouldBeEnded(){return this._endedOverride||this._mediaElementReportingEnded()}_mediaElementReportingEnded(){return!!(this._mediaElementAndState&&this._mediaElementAndState.element.ended&&this._mediaElementAndState.element.paused)}_handleDurationUpdates(){this._listenToOnce("loadedmetadata",()=>this._updateDurationFromMediaElement(),{reattach:!0,earlyAttach:!0}),this._listenTo("durationchange",()=>this._updateDurationFromMediaElement())}_updateDurationFromMediaElement(){let e=this._mediaElementAndState;e&&(this._duration=1e3*e.element.duration,this._handleDurationChange())}_handlePlayPauseChange(e,{fadeRate:t}){this._fadeRate=t||null;let i=()=>{this._mediaElementAndState&&"USABLE"===this._mediaElementAndState.state&&this._callMediaElementPause(this._mediaElementAndState.element),this._notifyFading(!1),this._completeSeekFadeOutAndIn(),this._notifyPlaying(!1)};if(this.isEnded())e?this._notifyPlaying(!0):i();else if(this._mediaElementAndState&&"USABLE"===this._mediaElementAndState.state){let r=this._playInProgress.inProgress||!this._isMediaElementPaused(this._mediaElementAndState.element);e&&!r?(this._fadeManagers&&this._fadeManagers.pausePlay.performFade(-1/0),this._playDetectionPosition=this._getTruePosition(),this._play(e=>this._notifyPlayRejection(e))):!e&&r?this._update(()=>{this._fadeManagers&&this._fadeManagers.pausePlay.getDirection()===n.UP?(this._notifyFading(!0),this._fadeManagers.pausePlay.performFade(t||-1/0,()=>i())):i()}):e&&r?this._update(()=>{this._fadeManagers&&this._fadeManagers.pausePlay.getDirection()===n.DOWN&&this._fadeManagers.pausePlay.performFade(t||1/0,()=>this._notifyFading(!1)),this._notifyPlaying(!0)}):this._notifyPlaying(e)}}_handleVolumeChange(e,t){if(this._mediaElementAndState){let i=this._mediaElementAndState.element;i.muted=t,i.volume=e,this._notifyVolumeChangeFromMediaEl(i)}else this._muted=t,this._volume=e,this._notifyVolumeChange(e,t)}_handleSeekChange(e,{fadeRate:t}){this._seekFadeRate=t,this._fadeRateAfterSeek=t.afterSeek||1/0;let i=this._mediaElementAndState;if(i&&"USABLE"===i.state){this._onSeekFadeOutCompleted=()=>{this._onSeekFadeOutCompleted=null,r&&r.remove(),i&&i.seek.getDirection()===n.DOWN&&(this._logger.debug("Fade out for seek completed.",e,t),i.seek.performFade(-1/0),this._notifyFadingForSeek(!1));let a=this._mediaElementReportingEnded();this._endedOverride=!1;let s=this._lastSeek={position:e,unstallTime:null};this._performSeek(e,t=>{if(void 0!==t){this._triggerError(new u.errors.PlayerFatalError("An error occurred when trying to seek.",t));return}e===this._duration&&(this._endedOverride=!0),this._update(()=>{if(this.isActuallyPlaying()&&this._assumeStalled(),this._updateCachedCurrentTime(!0),this._signalSeekComplete(),this.isStalled()){let e=this.onChange.subscribe(({dead:t,stalled:i})=>{t?e.remove():i||(s.unstallTime=I(),e.remove())})}else s.unstallTime=I();i&&(!this.isActuallyPlaying()||this._fadeRateAfterSeek===1/0||this.isEnded()?i.seek.performFade(1/0):this._notifyFadingForSeek(!0))})}),a&&this.isPlaying()&&this._play(e=>{this._triggerError(new u.errors.PlayerFatalError("Error when trying to play after seek from end.",e))})},this._fadeEndedHandle&&(this._fadeEndedHandle.remove(),this._fadeEndedHandle=null);let i=this._fadeManagers,r=null,a=()=>{this._onSeekFadeOutCompleted&&this._onSeekFadeOutCompleted()};this._update(()=>{i&&(t.beforeSeek||t.afterSeek)?(this._logger.debug("Fading out ready for seek.",e,t),(i.seek.getDirection()===n.UP||i.seek.isFading())&&this.isActuallyPlaying()&&t.beforeSeek&&!this._mediaElementReportingEnded()?(this._notifyFadingForSeek(!0),r=this._fadeEndedHandle=this._listenToOnce("ended",a),i.seek.performFade(t.beforeSeek||-1/0,a)):(i.seek.performFade(-1/0),a())):a()})}}_performSeek(e,t){let i=this._mediaElementAndState;if(!i)throw Error("Media element does not exist.");let r=this._currentSeek;r&&(this._currentSeek=null,r.abort());let n=i.element,a=0,s=e,l=()=>{let i=[],r=()=>{this._currentSeek&&(this._currentSeek.abort(),this._currentSeek=null),t()};try{n.currentTime=s/1e3}catch(t){this._logger.warn("Error when trying to seek.",t,e,s)}this._playDetectionPosition=1e3*n.currentTime;let d=window.setTimeout(()=>{this._logger.warn("Seek attempt failed. Retrying...",e,s,a),o(),s+=.001,l()},V(++a));i.push(this._listenToOnce("seeked",()=>{let t=1e3*n.currentTime;100>=Math.abs(t-s)?r():(this._logger.warn("Seek attempt failed. Incorect position. Retrying...",t,e,s),o(),l())},{earlyAttach:!0}));let o=()=>{i.forEach(e=>e.remove()),window.clearTimeout(d)};this._currentSeek={abort:o}};l()}_getPosition(){let e=null!==this._duration?this._duration:1/0;if(!this._mediaElementAndState||"USABLE"!==this._mediaElementAndState.state)return this._positionWhenMediaElementRevoked;this._determineIfPlaying();let t=Math.min(this._getTruePosition(),e);return this._shouldBeEnded()?e:t}_getTruePosition(){if(!this._mediaElementAndState||"USABLE"!==this._mediaElementAndState.state)throw Error("Media element does not exist or is in invalid state.");let{elTime:e,systemTime:t}=this._mediaElementAndState.cachedMediaElTime;return this.isStalled()||!this.isActuallyPlaying()?e:e+(I()-t)}_kill(){window.clearTimeout(this._canPlayTimer),this._playDetectionTimer&&window.clearInterval(this._playDetectionTimer),this._mediaElementAndState&&this.revokeMediaElement(),this._stallCheckTimerId&&window.clearInterval(this._stallCheckTimerId),this._webAudioOrchestration&&this._webAudioOrchestration.gainNodes.glitchCoverup.disconnect(this._webAudioOrchestration.context.destination),this._listeners=[]}_listenToOnce(e,t,i={}){let{reattach:r,earlyAttach:n}=i;void 0===r&&(r=!1),void 0===n&&(n=!1);let a=this._listenTo(e,e=>{a.remove(),t(e)},{reattach:r,earlyAttach:n});return a}_listenTo(e,t,i={}){let{reattach:r,earlyAttach:n}=i;void 0===r&&(r=!0),void 0===n&&(n=!1);let a=i=>{if(s.attachedToElement)switch(e){case"play":{let e=this._mediaElPlayShouldBeAborted.get(s.attachedToElement);if(this._mediaElPlayShouldBeAborted.delete(s.attachedToElement),e){this._logger.warn("Calling pause() on media element because the play request should have been rejected."),s.attachedToElement.pause();break}}default:t(i)}else this._logger.warn("Got media element event after handler was removed. Ignoring.",i)},s={attachedToElement:null,handler:a,eventType:e,once:!1,reattach:r,earlyAttach:n};if(this._listeners.push(s),!this._mediaElementAndState||"USABLE"!==this._mediaElementAndState.state&&!n)return{remove:()=>{let e=this._listeners.indexOf(s);e>=0&&this._listeners.splice(e,1)}};let{element:l}=this._mediaElementAndState;return l.addEventListener(e,a,!1),s.attachedToElement=l,{remove:()=>{let t=this._listeners.indexOf(s);t>=0&&(this._listeners.splice(t,1),s.attachedToElement=null,l.removeEventListener(e,a,!1))}}}_notifyNotStalled(){this._stallDetected=!1,this._lastStallCheckPos=null,this._handleStalled()}_assumeStalled(){this._mediaElementAndState&&"USABLE"===this._mediaElementAndState.state&&(this._lastStallCheckPos=1e3*this._mediaElementAndState.element.currentTime,this._timeWhenPositionChanged=0,this._stallDetected=!0,this._handleStalled())}_initMediaElement(e,t){this._initMediaElementLocal(e,t)}_callMediaElementPlay(e){O.isEdge()&&this._mediaElPlayShouldBeAborted.set(e,!1);let t=this._mediaElPaused.get(e);t&&(t.paused=!1);let i=this._mediaElPlayTracker={},r=e.play();return t&&r&&r.catch&&r.catch(()=>{i===this._mediaElPlayTracker&&(t.paused=!0)}),r}_callMediaElementPause(e){this._playInProgress.inProgress=!1,O.isEdge()&&this._mediaElPlayShouldBeAborted.has(e)&&this._mediaElPlayShouldBeAborted.set(e,!0);let t=this._mediaElPaused.get(e);t&&(t.paused=!0),e.pause()}_isMediaElementPaused(e){let t=this._mediaElPaused.get(e);return!t||t.paused}_createMediaElementSource(e){if(this._webAudioOrchestration&&this._fadeManagers){this._logger.debug("Creating media element source node...");let t=H.get(e);if(t?this._logger.debug("Reusing media element source node."):(t=this._webAudioOrchestration.context.createMediaElementSource(e),H.set(e,t)),this._webAudioOrchestration.mediaElementSource=t,t.connect(this._webAudioOrchestration.gainNodes.pausePlay),this._logger.debug("Created media element source node."),this._shouldCoverGlitch){let e=this._webAudioOrchestration.context.currentTime,t=this._webAudioOrchestration.gainNodes.glitchCoverup;t.gain.setValueAtTime(0,e),t.gain.setValueAtTime(1,e+.1),this._shouldCoverGlitch=!1}}}_completeCurrentFade(){let e=this._fadeManagers;e&&(e.pausePlay.performFade(this.isPlaying()?1/0:-1/0),this.isDead()||this._notifyFading(!1))}_completeSeekFadeOutAndIn(){let e=this._fadeManagers;e&&this._update(()=>{e.seek.performFade(1/0),!this.isDead()&&(this._notifyFadingForSeek(!1),this._onSeekFadeOutCompleted&&this._onSeekFadeOutCompleted())})}_determineIfPlaying(){this._playDetectionTimer&&(!this.isPlaying()||++this._playDetectionTimerNumAttempts>=200)&&(window.clearInterval(this._playDetectionTimer),this._playDetectionTimer=null),this._update(()=>{this._mediaElementAndState&&"USABLE"===this._mediaElementAndState.state&&!this.isDead()&&this.isReady()&&this.isPlaying()&&!this.isActuallyPlaying()&&!this._isMediaElementPaused(this._mediaElementAndState.element)&&this._getTruePosition()!==this._playDetectionPosition&&(this._logger.debug("Detected that playback has started."),this._playDetectionTimer&&(window.clearInterval(this._playDetectionTimer),this._playDetectionTimer=null),this._notifyPlaying(!0),this._fadeManagers&&(this._notifyFading(!0),this._fadeManagers.pausePlay.performFade(this._fadeRate||1/0,()=>this._notifyFading(!1))))})}_updateCachedCurrentTime(e=!1){this._mediaElementAndState&&"USABLE"===this._mediaElementAndState.state&&(e||!this._mediaElementAndState.element.seeking)&&(this._mediaElementAndState.cachedMediaElTime={elTime:1e3*this._mediaElementAndState.element.currentTime,systemTime:I()})}_addCachedCurrentTimeListeners(){this.onChange.subscribe(({actuallyPlaying:e,stalled:t})=>{(void 0!==e||void 0!==t)&&this._updateCachedCurrentTime()})}_initMediaElementLocal(e,t){if(e.setAttribute("msAudioCategory","BackgroundCapableMedia"),e.mozAudioChannelType="content",e.removeAttribute("src"),function(e){e.load()}(e),this._activateWebAudio(),this._pauseEventTimer&&(this._logger.debug("Clearing pause event timer."),window.clearTimeout(this._pauseEventTimer),this._pauseEventTimer=null),this._webAudioOrchestration&&this._webAudioOrchestration.mediaElementSource&&(this._logger.debug("Disconnecting media element from gain node."),this._webAudioOrchestration.mediaElementSource.disconnect(this._webAudioOrchestration.gainNodes.pausePlay),this._webAudioOrchestration.mediaElementSource=void 0),this._currentSeek&&(this._logger.debug("Aborting seek attempt."),this._currentSeek.abort(),this._currentSeek=null),t){this._webAudioOrchestration&&(this._logger.debug("Adding crossorigin attribute to media element because fading enabled."),e.setAttribute("crossorigin","anonymous"));let t=this._getUrlForMediaElement();this._logger.debug("Setting media element src.",t),e.src=t,e.volume=this._volume,e.muted=this._muted,this._createMediaElementSource(e)}e.playbackRate=1,e.setAttribute("preload","metadata"),this._callMediaElementPause(e),e.load()}_addPausedHandlers(e){let t={removeListeners:()=>{e.removeEventListener("play",i),e.removeEventListener("playing",i),e.removeEventListener("pause",i),e.removeEventListener("ended",i)},paused:!1},i=()=>{t.paused=e.paused};i(),e.addEventListener("play",i),e.addEventListener("playing",i),e.addEventListener("pause",i),e.addEventListener("ended",i),this._mediaElPaused.set(e,t)}_removePausedHandlers(e){let t=this._mediaElPaused.get(e);t&&t.removeListeners(),this._mediaElPaused.delete(e)}_checkIfStalled(){if(!this._mediaElementAndState||"USABLE"!==this._mediaElementAndState.state||!this.isActuallyPlaying())return;let e=this._mediaElementAndState.element,t=1e3*e.currentTime,i=u.helpers.time.now();t!==this._lastStallCheckPos&&(this._timeWhenPositionChanged=i),this._stallDetected=e.readyState<=2||this._timeWhenPositionChanged<=i-500,this._lastStallCheckPos=t,this._handleStalled()}_handleStalled(){this._shouldBeEnded()&&null===this._getQueuedSeekPosition()?this.isEnded()||(this._logger.debug("Updating because stalled near end."),this._update()):this._notifyStalled(this._stallDetected||!this._mediaElementAndState||"USABLE"!==this._mediaElementAndState.state)}_play(e){let t=this._activateWebAudio(),i={inProgress:!0};this._playInProgress=i,this._mediaElementPlay().then(()=>{i.inProgress=!1,t.catch(e=>{this._logger.error("Error activating web audio.",e),e===P?this._triggerError(new f):this._triggerError(new y)})}).catch(t=>{if(this._playInProgress!==i){this._logger.debug("Ignoring play error because paused since.",t);return}i.inProgress=!1,e&&e(t)})}_mediaElementPlay(){if(this._mediaElementAndState){if(this._mediaElementReportingEnded())return this._logger.debug("Not calling play() because we are at the end. It will be called after a seek."),D.resolve()}else throw Error("Media element doesn't exist.");let e=this._mediaElementAndState.element,t=this._callMediaElementPlay(e);return new D((e,i)=>{t?(t=t.then(()=>e())).catch&&(t=t.catch(t=>{"AbortError"===t.name?(this._logger.debug("Media element play() promise rejected with AbortError."),e()):i(t)})):e()})}_notifyVolumeChangeFromMediaEl(e){this._volume=e.volume,this._muted=e.muted,this._notifyVolumeChange(e.volume,e.muted)}_initWebAudio(){try{let e=this._webAudioContext.getAudioContextWithSuspender();if(!e)return this._logger.debug("WebAudio not supported/enabled."),null;this._logger.debug("WebAudio supported.");let{context:t,suspender:i}=e;i.watchPlayer(this);let r=t.createGain(),n=t.createGain(),a=t.createGain();return r.connect(n),n.connect(a),a.connect(t.destination),{context:t,suspender:i,gainNodes:{glitchCoverup:a,pausePlay:r,seek:n}}}catch(e){return e===T?this._triggerError(new S(e)):this._triggerError(new A(e)),this._logger.error("Failed initializing web audio.",e),null}}_activateWebAudio(){return this._webAudioOrchestration?this._webAudioContext.activate():D.resolve(void 0)}_handleDeferredPauseAndSeek(){if(!this._mediaElementAndState||"STABLE"!==this._mediaElementAndState.state)throw Error("Media element must be in the STABLE state.");this._logger.debug("Handling deferred pause and seek...");let e=this._mediaElementAndState.element;this._mediaElementAndState={state:"USABLE",element:e,cachedMediaElTime:{systemTime:I(),elTime:1e3*e.currentTime}},this._attachListeners(),this._update(()=>{this._handleStalled();let e=this._getQueuedSeekPosition();if(null!==e){let t=this._seekFadeRate?this._seekFadeRate.afterSeek:void 0;this._handleSeekChange(e,{fadeRate:{afterSeek:t}})}this.isPlaying()!==this.isActuallyPlaying()&&this._handlePlayPauseChange(this.isPlaying(),{fadeRate:this._fadeRate||void 0})})}_detachListeners(){if(!this._mediaElementAndState)throw Error("Media element doesn't exist.");let e=this._mediaElementAndState.element;this._listeners.forEach(t=>{t.attachedToElement&&(t.attachedToElement=null,e.removeEventListener(t.eventType,t.handler,!1))}),this._listeners=this._listeners.filter(e=>e.reattach)}_attachListeners(){if(!this._mediaElementAndState)throw Error("Media element doesn't exist.");this._logger.debug("Attaching listeners...");let{element:e,state:t}=this._mediaElementAndState;this._listeners.forEach(i=>{!i.attachedToElement&&i.reattach&&("USABLE"===t||i.earlyAttach)&&(e.addEventListener(i.eventType,i.handler,!1),i.attachedToElement=e)}),this._logger.debug("Attached listeners.")}}let Y=u.helpers.Promise;class Q extends G{constructor(e,t){super(t),this._descriptor=e,this._mimeType=e.format.mimeType||x(e.format,this._inferFormat(e.url))}_getUrlForMediaElement(){return this._descriptor.url}_canPlay(){return this._mimeType&&this._canPlayType(this._mimeType)?Y.resolve(!0):Y.resolve(!1)}}(i=a||(a={})).DecodeError=c,i.NetworkError=g,i.MediaElementError=p,i.WebAudioInitializeError=A,i.WebAudioInitializeNoChannelsError=S,i.WebAudioActivationError=y,i.WebAudioActivationTimeoutError=f,((r=s||(s={})).timeRanges||(r.timeRanges={})).buildTimeRanges=m,(r.mimeType||(r.mimeType={})).buildMimeTypeFromFormat=x;let Z="31.1.0",$=2227;return h})(),e.exports=r(i(18471))},70677:function(e,t,i){var r;"undefined"!=typeof self&&self,r=(e,t,i)=>(()=>{"use strict";var r=[,t=>{t.exports=e},e=>{e.exports=t},e=>{e.exports=i}],n={};function a(e){var t=n[e];if(void 0!==t)return t.exports;var i=n[e]={exports:{}};return r[e](i,i.exports,a),i.exports}a.d=(e,t)=>{for(var i in t)a.o(t,i)&&!a.o(e,i)&&Object.defineProperty(e,i,{enumerable:!0,get:t[i]})},a.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),a.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})};var s={};a.r(s),a.d(s,{HTML5Player:()=>o.HTML5Player,HTML5PlayerController:()=>h,MediaElementManager:()=>_,buildNumber:()=>c,version:()=>g});var l=a(1),d=a(2),o=a(3);class h extends l.BaseController{constructor(e){super(),this._mediaElementManager=e,this.name="MaestroHTML5"}static errorQualifiesAbort(e){return!(e instanceof o.errors.WebAudioInitializeError)}isRenditionSupported(e,t,i){let r="mp3"===e.scFormat||"aac"===e.scFormat,n="hls"===e.scProtocol,a=i&&i.useIphoneHlsHack&&r&&function(e){try{return!!document.createElement("audio").canPlayType(e)}catch(e){return!1}}("application/vnd.apple.mpegurl");if(a&&n)return!0;let s="cbc-encrypted-hls"===e.scProtocol;return!!(a&&s&&i.fairPlayManager&&l.FairPlayManager.isSupported())||("http"===e.scProtocol||-1!==["hls","encrypted-hls"].indexOf(e.scProtocol)&&!t.streamUrlExpires)&&o.HTML5Player.isFormatSupported(e.maestroFormat)}buildPlayer(e){let{rendition:t,timeRetrieved:i}=e.urlAndRendition,r="hls"===t.scProtocol||"encrypted-hls"===t.scProtocol,n=-1!==navigator.userAgent.indexOf("iPhone"),a=e.useIphoneHlsHack&&n,s=e.fairPlayManager;if(a&&r);else if(a&&s&&"cbc-encrypted-hls"===t.scProtocol){let t=new u(e,this._mediaElementManager);return s.registerPlayer(t.getPlayer()),t}else if(e.streamUrlExpires&&(r||!(void 0!==i)))throw l.notSupportedError;return new u(e,this._mediaElementManager)}}class u{constructor(e,t){this._config=e,this._mediaElementManager=t;let{logger:i,playerId:r,urlAndRendition:n,streamUrlExpires:a,reportError:s,fadeOnPauseAndPlay:l,fadeOnSeek:d,releaseControl:u,seekStrategy:m}=e;this._logger=i;let{rendition:_,timeRetrieved:g}=n;if(a){if(void 0===g)throw Error("Expecting timeUrlRetrieved to be set.");this._expirationConfig={urlExpires:!0,timeUrlRetrieved:g}}else this._expirationConfig={urlExpires:!1};let c=this._player=new o.HTML5Player({url:n.url,format:_.maestroFormat},{name:r,mediaElement:null,fadeSupportEnabled:l||d,defaultFadeDuration:l?void 0:0,defaultSeekFadeInDuration:d?void 0:0,defaultSeekFadeOutDuration:d?void 0:0,webAudioContext:this._mediaElementManager.getWebAudioContext(),logger:this._logger,seekStrategy:m,registerListeners:({onError:e,onChange:t})=>{e.subscribe(e=>{e instanceof o.errors.NetworkError&&this._hasExpired()?(this._logger.info("Releasing control as a network error occurred, and the URL has expired."),u({retry:!0})):(s(e.getCode()),h.errorQualifiesAbort(e)&&u({retry:!1}))}),t.subscribe(({dead:e,playing:t,actuallyPlaying:i,seeking:r,duration:n})=>{if(e){u({retry:!1});return}if(n===1/0){this._logger.info("Releasing control because the duration was Infinity."),u({retry:!1});return}this._expirationConfig.urlExpires&&(t||i||r)&&this._checkIfUrlWillExpireBeforeEnd()})}});this._mediaElementManager.registerPlayer(c,()=>u({retry:!1}))}getPlayer(){return this._player}getUrl(){return this._config.urlAndRendition.url}_checkIfUrlWillExpireBeforeEnd(){let e=this._player.getDuration(),t=this._getExpireTime();if(null!==e&&null!==t){let i=e-this._player.getPosition();d.helpers.time.now()+i>t&&(this._logger.info("Releasing control because stream URL would expire before reaching end."),this._config.releaseControl({retry:!0}))}}_getExpireTime(){if(!this._expirationConfig.urlExpires)return null;let e=this._player.getDuration();return null===e?null:this._expirationConfig.timeUrlRetrieved+e+105e3}_hasExpired(){let e=this._getExpireTime();return null!==e&&e<=d.helpers.time.now()}}let m=new o.WebAudioContext;class _{constructor(e,t){this._type=e,this._playerListeners=new d.helpers.SCWeakMap,this._playerWithElement=null,this._canActivate=!0,this._provideMediaElementErrorRunCheck={},this._element=document.createElement(e),this._logger=d.logger.prefixLogger(t,"MediaElementManager")}activate(){this._canActivate&&(this._logger.debug("Activating media element."),this._element.load()),this._logger.debug("Activating web audio context."),m.activate()}registerPlayer(e,t,i=!1){if(this._playerListeners.has(e))throw Error("Player already registered.");let r=()=>{if(e.getMediaElement()!==this._element){this._playerWithElement&&(this._playerWithElement.getMediaElement()===this._element&&(this._logger.debug("Revoking media element from previous player."),this._playerWithElement.isPlaying()&&this._logger.warn("Revoking media element from a playing player."),this._playerWithElement.revokeMediaElement()),this._playerWithElement=null),this._canActivate=!1,i&&(this._logger.debug("Creating new media element."),this._element=document.createElement(this._type));let r=this._provideMediaElementErrorRunCheck={};this._logger.debug("Providing media element to new player."),e.provideMediaElement(this._element).catch(i=>{e.isDead()||this._provideMediaElementErrorRunCheck!==r||(this._logger.error("Error occurred providing media element to new player.",i),t(i))}),this._playerWithElement=e}},n=e.onChange.subscribe(({playing:e})=>{e&&r()});this._playerListeners.set(e,n),e.getMediaElement()&&e.revokeMediaElement(),e.isPlaying()&&r()}unregisterPlayer(e){let t=this._playerListeners.get(e);t&&(t.remove(),this._playerWithElement===e&&(this._playerWithElement=null,e.getMediaElement()===this._element&&e.revokeMediaElement()),this._playerListeners.delete(e))}getWebAudioContext(){return m}}let g="24.1.3",c=1201;return s})(),e.exports=r(i(49680),i(18471),i(37966))}}]);